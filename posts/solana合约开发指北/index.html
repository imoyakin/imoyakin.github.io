<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Solanaåˆçº¦å¼€å‘æŒ‡åŒ— | ç¬”è®°</title>
<meta name=keywords content>
<meta name=description content="Solanaåˆçº¦å¼€å‘æŒ‡åŒ— è¿™é‡Œå‡å®šsolanaéœ€è¦çš„å¼€å‘ç¯å¢ƒ: rust/node.jsç”šè‡³Solanaå®¢æˆ·ç«¯éƒ½å·²ç»è£…å¥½äº†.
åˆçº¦æ˜¯ä»€ä¹ˆ?ç®€å•æ¥è¯´,å°±æ˜¯åœ¨æä¾›å¤šä¸ªå‡½æ•°rpcè°ƒç”¨å,ç”¨æˆ·è¾“å…¥ç¬¦åˆç‰¹å®šéœ€æ±‚çš„ç»“æ„ä½“æ•°æ®å,è·å¾—é¢„æœŸçš„ç»“æœæˆ–è€…ç¬¦åˆè§„åˆ™çš„é”™è¯¯.åŒæ—¶æä¾›åœ¨å¯æ¥å—çš„å¤æ‚åº¦èŒƒå›´å†…,å­˜å‚¨å°‘é‡æœ‰å…³ç”¨æˆ·çš„å…ƒæ•°æ®.
 On Solana, smart contracts are called programs
 é¦–å…ˆ,å…ˆç¡®å®šsolanaçš„ç›¸å…³æœ¯è¯­.ä¸ºäº†ç¬¦åˆå®˜æ–¹çš„ç§°è°“,solanaä¸Šçš„æ™ºèƒ½åˆçº¦éƒ½è¢«ç§°ä½œprogramsè€Œésmart contracts.
éšå,æˆ‘ä»¬é¢„æƒ³ä¸€ä¸ªæ™ºèƒ½èƒ½åˆçº¦æ¡ˆä¾‹,æ¥å±•å¼€æè¿°åœ¨solanaä¸Šå¼€å‘æ™ºèƒ½åˆçº¦è¦å¤„ç†å“ªäº›ç»†èŠ‚.
Example Escrow AliceæŒæœ‰token X, BobæŒæœ‰token Y,ä»–ä»¬äº’ç›¸ä¹‹é—´è¾¾æˆäº†äº¤æ˜“çº¦å®š: Alice æ”¯ä»˜100X,å’ŒBobæ‰‹é‡Œ50Yè¿›è¡Œå…‘æ¢.å’Œæˆ‘ä»¬è´­ç‰©ä½¿ç”¨æ·˜å®ä¸€æ ·,Aliceå’ŒBobéƒ½å®³æ€•äº¤é’±ä¸å‘,æ‰€ä»¥éœ€è¦ä¸€ä¸ªèƒ½å……å½“æ”¯ä»˜å®çš„æ™ºèƒ½åˆä½œä½œä¸ºä¸€ä¸ªå¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æ‰˜ç®¡,è¿™å°±æ˜¯æˆ‘ä»¬æ¡ˆä¾‹: Escrow.
ç›´è§‚çš„å»æƒ³,è®©Aliceå‘èµ·äº¤æ˜“çš„æ—¶å€™è½¬è´¦ç»™åˆçº¦å°±è¡Œ,è®©Bobåç»­å»æ‰¾åˆçº¦æ‹¿é’±.ä½†è¿™æ˜¯ä¼ ç»Ÿæ”¯ä»˜å®çš„åšæ³•:æ”¯ä»˜å®æ‹¥æœ‰ä¸€ä¸ªå·¨å¤§çš„æ•°æ®åº“,å¯ä»¥é€šè¿‡é”®å€¼çš„æ–¹å¼è®°å½•ä¸‹ä¸åŒæ•°ä»¥äº¿è®¡çš„ç”¨æˆ·çš„äº¤æ˜“å¯¹.åœ¨solanaä¸Š,æ™ºèƒ½åˆçº¦çš„æ•°æ®å­˜å‚¨æ˜¯é€šè¿‡accountæ¥å®ç°çš„,è€Œæ¯ä¸€ä¸ªaccountæœ€å¤šåªèƒ½æä¾›32KBçš„æ•°æ®å­˜å‚¨,æ— æ³•å­˜å‚¨è·Ÿåˆçº¦æ— å…³çš„ç”¨æˆ·æ•°æ®.
solanaå¹¶ä¸æ˜¯æ²¡æœ‰é¢„è§åˆ°è¿™ç‚¹,å…¶æä¾›çš„PDA(ç¨‹åºå§”æ‰˜è´¦æˆ·)èƒ½ä»£æˆ‘ä»¬åšåˆ°è®°å½•æ— é™çš„æ•°æ®è´¦æˆ·&ndash;å½“ç”¨æˆ·ä¸åˆçº¦äº¤æ˜“æ—¶,ä¸ºå…¶ç”Ÿæˆä¸“å±çš„accountæ¥å­˜å‚¨äº¤æ˜“ç»†èŠ‚.å½“Aliceå’Œæ™ºèƒ½åˆçº¦äº’åŠ¨çš„æ—¶å€™, æ™ºèƒ½åˆçº¦é€šè¿‡ç¡®å®šçš„ç§å­ç”Ÿæˆä¸€ä¸ªPDAè´¦æˆ·æ¥å¤„ç†è¿™ç¬”äº¤æ˜“.
graph LR: Alice -> è®©æˆ‘ä»¬å±•å¼€,ä¸€ç‚¹ç‚¹çš„æ‹ä¸‹å®ç°ç»†èŠ‚.
Setting up the project æˆ‘ä»¬å¯ä»¥å‚ç…§è¿™ä¸ªæ¡ˆä¾‹åˆ›å»ºä¸€ä¸ªrustçš„é¡¹ç›®,æˆ‘ä»¬ä¿®æ”¹Cargo.toml,è®©å…¶çŸ¥é“æˆ‘ä»¬éœ€è¦çš„ä¾èµ–å’Œç¼–è¯‘ç»“æœäº§å‡º.
[package] name = &#34;solana-escrow&#34; version = &#34;0.1.0&#34; edition = &#34;2021&#34; license = &#34;WTFPL&#34; publish = false [dependencies] solana-program = &#34;1.9.4&#34; [lib] crate-type = [&#34;cdylib&#34;, &#34;lib&#34;] entrypoint.rs, program, and accounts ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨ç€æ‰‹ç¼–å†™è¿™ä¸ªæ™ºèƒ½åˆçº¦äº†!å¦‚æˆ‘ä»¬æ‰€è§,æœ€åç¼–è¯‘æˆeBPFçš„ç¨‹åº,å…¥å£å¤„åœ¨lib.rsä¸­,æˆ‘ä»¬é€šè¿‡useæ¥å¼•å…¥ä»»ä½•è¢«å¯¼å…¥çš„å‡½æ•°,é€šè¿‡entrypoint!è¿™ä¸ªå®æ¥å®šä¹‰process_instructionå‡½æ•°.è¿™æ˜¯å”¯ä¸€è°ƒç”¨æ™ºèƒ½åˆçº¦çš„æ–¹æ³•,æ‰€æœ‰çš„åˆçº¦è°ƒç”¨éƒ½æ˜¯é€šè¿‡entrypointæ¥è§¦å‘.
 è¢«è°ƒç”¨çš„æ—¶å€™, programè¢«ä¼ é€’ç»™BPF Loader.">
<meta name=author content="Me">
<link rel=canonical href=https://blog.explosion.zip/posts/solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8C%97/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.explosion.zip/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=16x16 href=https://blog.explosion.zip/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=32x32 href=https://blog.explosion.zip/%3Clink%20/%20abs%20url%3E>
<link rel=apple-touch-icon href=https://blog.explosion.zip/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=https://blog.explosion.zip/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Solanaåˆçº¦å¼€å‘æŒ‡åŒ—">
<meta property="og:description" content="Solanaåˆçº¦å¼€å‘æŒ‡åŒ— è¿™é‡Œå‡å®šsolanaéœ€è¦çš„å¼€å‘ç¯å¢ƒ: rust/node.jsç”šè‡³Solanaå®¢æˆ·ç«¯éƒ½å·²ç»è£…å¥½äº†.
åˆçº¦æ˜¯ä»€ä¹ˆ?ç®€å•æ¥è¯´,å°±æ˜¯åœ¨æä¾›å¤šä¸ªå‡½æ•°rpcè°ƒç”¨å,ç”¨æˆ·è¾“å…¥ç¬¦åˆç‰¹å®šéœ€æ±‚çš„ç»“æ„ä½“æ•°æ®å,è·å¾—é¢„æœŸçš„ç»“æœæˆ–è€…ç¬¦åˆè§„åˆ™çš„é”™è¯¯.åŒæ—¶æä¾›åœ¨å¯æ¥å—çš„å¤æ‚åº¦èŒƒå›´å†…,å­˜å‚¨å°‘é‡æœ‰å…³ç”¨æˆ·çš„å…ƒæ•°æ®.
 On Solana, smart contracts are called programs
 é¦–å…ˆ,å…ˆç¡®å®šsolanaçš„ç›¸å…³æœ¯è¯­.ä¸ºäº†ç¬¦åˆå®˜æ–¹çš„ç§°è°“,solanaä¸Šçš„æ™ºèƒ½åˆçº¦éƒ½è¢«ç§°ä½œprogramsè€Œésmart contracts.
éšå,æˆ‘ä»¬é¢„æƒ³ä¸€ä¸ªæ™ºèƒ½èƒ½åˆçº¦æ¡ˆä¾‹,æ¥å±•å¼€æè¿°åœ¨solanaä¸Šå¼€å‘æ™ºèƒ½åˆçº¦è¦å¤„ç†å“ªäº›ç»†èŠ‚.
Example Escrow AliceæŒæœ‰token X, BobæŒæœ‰token Y,ä»–ä»¬äº’ç›¸ä¹‹é—´è¾¾æˆäº†äº¤æ˜“çº¦å®š: Alice æ”¯ä»˜100X,å’ŒBobæ‰‹é‡Œ50Yè¿›è¡Œå…‘æ¢.å’Œæˆ‘ä»¬è´­ç‰©ä½¿ç”¨æ·˜å®ä¸€æ ·,Aliceå’ŒBobéƒ½å®³æ€•äº¤é’±ä¸å‘,æ‰€ä»¥éœ€è¦ä¸€ä¸ªèƒ½å……å½“æ”¯ä»˜å®çš„æ™ºèƒ½åˆä½œä½œä¸ºä¸€ä¸ªå¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æ‰˜ç®¡,è¿™å°±æ˜¯æˆ‘ä»¬æ¡ˆä¾‹: Escrow.
ç›´è§‚çš„å»æƒ³,è®©Aliceå‘èµ·äº¤æ˜“çš„æ—¶å€™è½¬è´¦ç»™åˆçº¦å°±è¡Œ,è®©Bobåç»­å»æ‰¾åˆçº¦æ‹¿é’±.ä½†è¿™æ˜¯ä¼ ç»Ÿæ”¯ä»˜å®çš„åšæ³•:æ”¯ä»˜å®æ‹¥æœ‰ä¸€ä¸ªå·¨å¤§çš„æ•°æ®åº“,å¯ä»¥é€šè¿‡é”®å€¼çš„æ–¹å¼è®°å½•ä¸‹ä¸åŒæ•°ä»¥äº¿è®¡çš„ç”¨æˆ·çš„äº¤æ˜“å¯¹.åœ¨solanaä¸Š,æ™ºèƒ½åˆçº¦çš„æ•°æ®å­˜å‚¨æ˜¯é€šè¿‡accountæ¥å®ç°çš„,è€Œæ¯ä¸€ä¸ªaccountæœ€å¤šåªèƒ½æä¾›32KBçš„æ•°æ®å­˜å‚¨,æ— æ³•å­˜å‚¨è·Ÿåˆçº¦æ— å…³çš„ç”¨æˆ·æ•°æ®.
solanaå¹¶ä¸æ˜¯æ²¡æœ‰é¢„è§åˆ°è¿™ç‚¹,å…¶æä¾›çš„PDA(ç¨‹åºå§”æ‰˜è´¦æˆ·)èƒ½ä»£æˆ‘ä»¬åšåˆ°è®°å½•æ— é™çš„æ•°æ®è´¦æˆ·&ndash;å½“ç”¨æˆ·ä¸åˆçº¦äº¤æ˜“æ—¶,ä¸ºå…¶ç”Ÿæˆä¸“å±çš„accountæ¥å­˜å‚¨äº¤æ˜“ç»†èŠ‚.å½“Aliceå’Œæ™ºèƒ½åˆçº¦äº’åŠ¨çš„æ—¶å€™, æ™ºèƒ½åˆçº¦é€šè¿‡ç¡®å®šçš„ç§å­ç”Ÿæˆä¸€ä¸ªPDAè´¦æˆ·æ¥å¤„ç†è¿™ç¬”äº¤æ˜“.
graph LR: Alice -> è®©æˆ‘ä»¬å±•å¼€,ä¸€ç‚¹ç‚¹çš„æ‹ä¸‹å®ç°ç»†èŠ‚.
Setting up the project æˆ‘ä»¬å¯ä»¥å‚ç…§è¿™ä¸ªæ¡ˆä¾‹åˆ›å»ºä¸€ä¸ªrustçš„é¡¹ç›®,æˆ‘ä»¬ä¿®æ”¹Cargo.toml,è®©å…¶çŸ¥é“æˆ‘ä»¬éœ€è¦çš„ä¾èµ–å’Œç¼–è¯‘ç»“æœäº§å‡º.
[package] name = &#34;solana-escrow&#34; version = &#34;0.1.0&#34; edition = &#34;2021&#34; license = &#34;WTFPL&#34; publish = false [dependencies] solana-program = &#34;1.9.4&#34; [lib] crate-type = [&#34;cdylib&#34;, &#34;lib&#34;] entrypoint.rs, program, and accounts ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨ç€æ‰‹ç¼–å†™è¿™ä¸ªæ™ºèƒ½åˆçº¦äº†!å¦‚æˆ‘ä»¬æ‰€è§,æœ€åç¼–è¯‘æˆeBPFçš„ç¨‹åº,å…¥å£å¤„åœ¨lib.rsä¸­,æˆ‘ä»¬é€šè¿‡useæ¥å¼•å…¥ä»»ä½•è¢«å¯¼å…¥çš„å‡½æ•°,é€šè¿‡entrypoint!è¿™ä¸ªå®æ¥å®šä¹‰process_instructionå‡½æ•°.è¿™æ˜¯å”¯ä¸€è°ƒç”¨æ™ºèƒ½åˆçº¦çš„æ–¹æ³•,æ‰€æœ‰çš„åˆçº¦è°ƒç”¨éƒ½æ˜¯é€šè¿‡entrypointæ¥è§¦å‘.
 è¢«è°ƒç”¨çš„æ—¶å€™, programè¢«ä¼ é€’ç»™BPF Loader.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.explosion.zip/posts/solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8C%97/"><meta property="og:image" content="https://blog.explosion.zip/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-08-30T13:22:27+08:00">
<meta property="article:modified_time" content="2022-08-30T13:22:27+08:00"><meta property="og:site_name" content="ExampleSite">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.explosion.zip/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="Solanaåˆçº¦å¼€å‘æŒ‡åŒ—">
<meta name=twitter:description content="Solanaåˆçº¦å¼€å‘æŒ‡åŒ— è¿™é‡Œå‡å®šsolanaéœ€è¦çš„å¼€å‘ç¯å¢ƒ: rust/node.jsç”šè‡³Solanaå®¢æˆ·ç«¯éƒ½å·²ç»è£…å¥½äº†.
åˆçº¦æ˜¯ä»€ä¹ˆ?ç®€å•æ¥è¯´,å°±æ˜¯åœ¨æä¾›å¤šä¸ªå‡½æ•°rpcè°ƒç”¨å,ç”¨æˆ·è¾“å…¥ç¬¦åˆç‰¹å®šéœ€æ±‚çš„ç»“æ„ä½“æ•°æ®å,è·å¾—é¢„æœŸçš„ç»“æœæˆ–è€…ç¬¦åˆè§„åˆ™çš„é”™è¯¯.åŒæ—¶æä¾›åœ¨å¯æ¥å—çš„å¤æ‚åº¦èŒƒå›´å†…,å­˜å‚¨å°‘é‡æœ‰å…³ç”¨æˆ·çš„å…ƒæ•°æ®.
 On Solana, smart contracts are called programs
 é¦–å…ˆ,å…ˆç¡®å®šsolanaçš„ç›¸å…³æœ¯è¯­.ä¸ºäº†ç¬¦åˆå®˜æ–¹çš„ç§°è°“,solanaä¸Šçš„æ™ºèƒ½åˆçº¦éƒ½è¢«ç§°ä½œprogramsè€Œésmart contracts.
éšå,æˆ‘ä»¬é¢„æƒ³ä¸€ä¸ªæ™ºèƒ½èƒ½åˆçº¦æ¡ˆä¾‹,æ¥å±•å¼€æè¿°åœ¨solanaä¸Šå¼€å‘æ™ºèƒ½åˆçº¦è¦å¤„ç†å“ªäº›ç»†èŠ‚.
Example Escrow AliceæŒæœ‰token X, BobæŒæœ‰token Y,ä»–ä»¬äº’ç›¸ä¹‹é—´è¾¾æˆäº†äº¤æ˜“çº¦å®š: Alice æ”¯ä»˜100X,å’ŒBobæ‰‹é‡Œ50Yè¿›è¡Œå…‘æ¢.å’Œæˆ‘ä»¬è´­ç‰©ä½¿ç”¨æ·˜å®ä¸€æ ·,Aliceå’ŒBobéƒ½å®³æ€•äº¤é’±ä¸å‘,æ‰€ä»¥éœ€è¦ä¸€ä¸ªèƒ½å……å½“æ”¯ä»˜å®çš„æ™ºèƒ½åˆä½œä½œä¸ºä¸€ä¸ªå¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æ‰˜ç®¡,è¿™å°±æ˜¯æˆ‘ä»¬æ¡ˆä¾‹: Escrow.
ç›´è§‚çš„å»æƒ³,è®©Aliceå‘èµ·äº¤æ˜“çš„æ—¶å€™è½¬è´¦ç»™åˆçº¦å°±è¡Œ,è®©Bobåç»­å»æ‰¾åˆçº¦æ‹¿é’±.ä½†è¿™æ˜¯ä¼ ç»Ÿæ”¯ä»˜å®çš„åšæ³•:æ”¯ä»˜å®æ‹¥æœ‰ä¸€ä¸ªå·¨å¤§çš„æ•°æ®åº“,å¯ä»¥é€šè¿‡é”®å€¼çš„æ–¹å¼è®°å½•ä¸‹ä¸åŒæ•°ä»¥äº¿è®¡çš„ç”¨æˆ·çš„äº¤æ˜“å¯¹.åœ¨solanaä¸Š,æ™ºèƒ½åˆçº¦çš„æ•°æ®å­˜å‚¨æ˜¯é€šè¿‡accountæ¥å®ç°çš„,è€Œæ¯ä¸€ä¸ªaccountæœ€å¤šåªèƒ½æä¾›32KBçš„æ•°æ®å­˜å‚¨,æ— æ³•å­˜å‚¨è·Ÿåˆçº¦æ— å…³çš„ç”¨æˆ·æ•°æ®.
solanaå¹¶ä¸æ˜¯æ²¡æœ‰é¢„è§åˆ°è¿™ç‚¹,å…¶æä¾›çš„PDA(ç¨‹åºå§”æ‰˜è´¦æˆ·)èƒ½ä»£æˆ‘ä»¬åšåˆ°è®°å½•æ— é™çš„æ•°æ®è´¦æˆ·&ndash;å½“ç”¨æˆ·ä¸åˆçº¦äº¤æ˜“æ—¶,ä¸ºå…¶ç”Ÿæˆä¸“å±çš„accountæ¥å­˜å‚¨äº¤æ˜“ç»†èŠ‚.å½“Aliceå’Œæ™ºèƒ½åˆçº¦äº’åŠ¨çš„æ—¶å€™, æ™ºèƒ½åˆçº¦é€šè¿‡ç¡®å®šçš„ç§å­ç”Ÿæˆä¸€ä¸ªPDAè´¦æˆ·æ¥å¤„ç†è¿™ç¬”äº¤æ˜“.
graph LR: Alice -> è®©æˆ‘ä»¬å±•å¼€,ä¸€ç‚¹ç‚¹çš„æ‹ä¸‹å®ç°ç»†èŠ‚.
Setting up the project æˆ‘ä»¬å¯ä»¥å‚ç…§è¿™ä¸ªæ¡ˆä¾‹åˆ›å»ºä¸€ä¸ªrustçš„é¡¹ç›®,æˆ‘ä»¬ä¿®æ”¹Cargo.toml,è®©å…¶çŸ¥é“æˆ‘ä»¬éœ€è¦çš„ä¾èµ–å’Œç¼–è¯‘ç»“æœäº§å‡º.
[package] name = &#34;solana-escrow&#34; version = &#34;0.1.0&#34; edition = &#34;2021&#34; license = &#34;WTFPL&#34; publish = false [dependencies] solana-program = &#34;1.9.4&#34; [lib] crate-type = [&#34;cdylib&#34;, &#34;lib&#34;] entrypoint.rs, program, and accounts ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨ç€æ‰‹ç¼–å†™è¿™ä¸ªæ™ºèƒ½åˆçº¦äº†!å¦‚æˆ‘ä»¬æ‰€è§,æœ€åç¼–è¯‘æˆeBPFçš„ç¨‹åº,å…¥å£å¤„åœ¨lib.rsä¸­,æˆ‘ä»¬é€šè¿‡useæ¥å¼•å…¥ä»»ä½•è¢«å¯¼å…¥çš„å‡½æ•°,é€šè¿‡entrypoint!è¿™ä¸ªå®æ¥å®šä¹‰process_instructionå‡½æ•°.è¿™æ˜¯å”¯ä¸€è°ƒç”¨æ™ºèƒ½åˆçº¦çš„æ–¹æ³•,æ‰€æœ‰çš„åˆçº¦è°ƒç”¨éƒ½æ˜¯é€šè¿‡entrypointæ¥è§¦å‘.
 è¢«è°ƒç”¨çš„æ—¶å€™, programè¢«ä¼ é€’ç»™BPF Loader.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.explosion.zip/posts/"},{"@type":"ListItem","position":2,"name":"Solanaåˆçº¦å¼€å‘æŒ‡åŒ—","item":"https://blog.explosion.zip/posts/solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8C%97/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Solanaåˆçº¦å¼€å‘æŒ‡åŒ—","name":"Solanaåˆçº¦å¼€å‘æŒ‡åŒ—","description":"Solanaåˆçº¦å¼€å‘æŒ‡åŒ— è¿™é‡Œå‡å®šsolanaéœ€è¦çš„å¼€å‘ç¯å¢ƒ: rust/node.jsç”šè‡³Solanaå®¢æˆ·ç«¯éƒ½å·²ç»è£…å¥½äº†.\nåˆçº¦æ˜¯ä»€ä¹ˆ?ç®€å•æ¥è¯´,å°±æ˜¯åœ¨æä¾›å¤šä¸ªå‡½æ•°rpcè°ƒç”¨å,ç”¨æˆ·è¾“å…¥ç¬¦åˆç‰¹å®šéœ€æ±‚çš„ç»“æ„ä½“æ•°æ®å,è·å¾—é¢„æœŸçš„ç»“æœæˆ–è€…ç¬¦åˆè§„åˆ™çš„é”™è¯¯.åŒæ—¶æä¾›åœ¨å¯æ¥å—çš„å¤æ‚åº¦èŒƒå›´å†…,å­˜å‚¨å°‘é‡æœ‰å…³ç”¨æˆ·çš„å…ƒæ•°æ®.\n On Solana, smart contracts are called programs\n é¦–å…ˆ,å…ˆç¡®å®šsolanaçš„ç›¸å…³æœ¯è¯­.ä¸ºäº†ç¬¦åˆå®˜æ–¹çš„ç§°è°“,solanaä¸Šçš„æ™ºèƒ½åˆçº¦éƒ½è¢«ç§°ä½œprogramsè€Œésmart contracts.\néšå,æˆ‘ä»¬é¢„æƒ³ä¸€ä¸ªæ™ºèƒ½èƒ½åˆçº¦æ¡ˆä¾‹,æ¥å±•å¼€æè¿°åœ¨solanaä¸Šå¼€å‘æ™ºèƒ½åˆçº¦è¦å¤„ç†å“ªäº›ç»†èŠ‚.\nExample Escrow AliceæŒæœ‰token X, BobæŒæœ‰token Y,ä»–ä»¬äº’ç›¸ä¹‹é—´è¾¾æˆäº†äº¤æ˜“çº¦å®š: Alice æ”¯ä»˜100X,å’ŒBobæ‰‹é‡Œ50Yè¿›è¡Œå…‘æ¢.å’Œæˆ‘ä»¬è´­ç‰©ä½¿ç”¨æ·˜å®ä¸€æ ·,Aliceå’ŒBobéƒ½å®³æ€•äº¤é’±ä¸å‘,æ‰€ä»¥éœ€è¦ä¸€ä¸ªèƒ½å……å½“æ”¯ä»˜å®çš„æ™ºèƒ½åˆä½œä½œä¸ºä¸€ä¸ªå¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æ‰˜ç®¡,è¿™å°±æ˜¯æˆ‘ä»¬æ¡ˆä¾‹: Escrow.\nç›´è§‚çš„å»æƒ³,è®©Aliceå‘èµ·äº¤æ˜“çš„æ—¶å€™è½¬è´¦ç»™åˆçº¦å°±è¡Œ,è®©Bobåç»­å»æ‰¾åˆçº¦æ‹¿é’±.ä½†è¿™æ˜¯ä¼ ç»Ÿæ”¯ä»˜å®çš„åšæ³•:æ”¯ä»˜å®æ‹¥æœ‰ä¸€ä¸ªå·¨å¤§çš„æ•°æ®åº“,å¯ä»¥é€šè¿‡é”®å€¼çš„æ–¹å¼è®°å½•ä¸‹ä¸åŒæ•°ä»¥äº¿è®¡çš„ç”¨æˆ·çš„äº¤æ˜“å¯¹.åœ¨solanaä¸Š,æ™ºèƒ½åˆçº¦çš„æ•°æ®å­˜å‚¨æ˜¯é€šè¿‡accountæ¥å®ç°çš„,è€Œæ¯ä¸€ä¸ªaccountæœ€å¤šåªèƒ½æä¾›32KBçš„æ•°æ®å­˜å‚¨,æ— æ³•å­˜å‚¨è·Ÿåˆçº¦æ— å…³çš„ç”¨æˆ·æ•°æ®.\nsolanaå¹¶ä¸æ˜¯æ²¡æœ‰é¢„è§åˆ°è¿™ç‚¹,å…¶æä¾›çš„PDA(ç¨‹åºå§”æ‰˜è´¦æˆ·)èƒ½ä»£æˆ‘ä»¬åšåˆ°è®°å½•æ— é™çš„æ•°æ®è´¦æˆ·\u0026ndash;å½“ç”¨æˆ·ä¸åˆçº¦äº¤æ˜“æ—¶,ä¸ºå…¶ç”Ÿæˆä¸“å±çš„accountæ¥å­˜å‚¨äº¤æ˜“ç»†èŠ‚.å½“Aliceå’Œæ™ºèƒ½åˆçº¦äº’åŠ¨çš„æ—¶å€™, æ™ºèƒ½åˆçº¦é€šè¿‡ç¡®å®šçš„ç§å­ç”Ÿæˆä¸€ä¸ªPDAè´¦æˆ·æ¥å¤„ç†è¿™ç¬”äº¤æ˜“.\ngraph LR: Alice -\u0026gt; è®©æˆ‘ä»¬å±•å¼€,ä¸€ç‚¹ç‚¹çš„æ‹ä¸‹å®ç°ç»†èŠ‚.\nSetting up the project æˆ‘ä»¬å¯ä»¥å‚ç…§è¿™ä¸ªæ¡ˆä¾‹åˆ›å»ºä¸€ä¸ªrustçš„é¡¹ç›®,æˆ‘ä»¬ä¿®æ”¹Cargo.toml,è®©å…¶çŸ¥é“æˆ‘ä»¬éœ€è¦çš„ä¾èµ–å’Œç¼–è¯‘ç»“æœäº§å‡º.\n[package] name = \u0026#34;solana-escrow\u0026#34; version = \u0026#34;0.1.0\u0026#34; edition = \u0026#34;2021\u0026#34; license = \u0026#34;WTFPL\u0026#34; publish = false [dependencies] solana-program = \u0026#34;1.9.4\u0026#34; [lib] crate-type = [\u0026#34;cdylib\u0026#34;, \u0026#34;lib\u0026#34;] entrypoint.rs, program, and accounts ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨ç€æ‰‹ç¼–å†™è¿™ä¸ªæ™ºèƒ½åˆçº¦äº†!å¦‚æˆ‘ä»¬æ‰€è§,æœ€åç¼–è¯‘æˆeBPFçš„ç¨‹åº,å…¥å£å¤„åœ¨lib.rsä¸­,æˆ‘ä»¬é€šè¿‡useæ¥å¼•å…¥ä»»ä½•è¢«å¯¼å…¥çš„å‡½æ•°,é€šè¿‡entrypoint!è¿™ä¸ªå®æ¥å®šä¹‰process_instructionå‡½æ•°.è¿™æ˜¯å”¯ä¸€è°ƒç”¨æ™ºèƒ½åˆçº¦çš„æ–¹æ³•,æ‰€æœ‰çš„åˆçº¦è°ƒç”¨éƒ½æ˜¯é€šè¿‡entrypointæ¥è§¦å‘.\n è¢«è°ƒç”¨çš„æ—¶å€™, programè¢«ä¼ é€’ç»™BPF Loader.","keywords":[],"articleBody":"Solanaåˆçº¦å¼€å‘æŒ‡åŒ— è¿™é‡Œå‡å®šsolanaéœ€è¦çš„å¼€å‘ç¯å¢ƒ: rust/node.jsç”šè‡³Solanaå®¢æˆ·ç«¯éƒ½å·²ç»è£…å¥½äº†.\nåˆçº¦æ˜¯ä»€ä¹ˆ?ç®€å•æ¥è¯´,å°±æ˜¯åœ¨æä¾›å¤šä¸ªå‡½æ•°rpcè°ƒç”¨å,ç”¨æˆ·è¾“å…¥ç¬¦åˆç‰¹å®šéœ€æ±‚çš„ç»“æ„ä½“æ•°æ®å,è·å¾—é¢„æœŸçš„ç»“æœæˆ–è€…ç¬¦åˆè§„åˆ™çš„é”™è¯¯.åŒæ—¶æä¾›åœ¨å¯æ¥å—çš„å¤æ‚åº¦èŒƒå›´å†…,å­˜å‚¨å°‘é‡æœ‰å…³ç”¨æˆ·çš„å…ƒæ•°æ®.\n On Solana, smart contracts are called programs\n é¦–å…ˆ,å…ˆç¡®å®šsolanaçš„ç›¸å…³æœ¯è¯­.ä¸ºäº†ç¬¦åˆå®˜æ–¹çš„ç§°è°“,solanaä¸Šçš„æ™ºèƒ½åˆçº¦éƒ½è¢«ç§°ä½œprogramsè€Œésmart contracts.\néšå,æˆ‘ä»¬é¢„æƒ³ä¸€ä¸ªæ™ºèƒ½èƒ½åˆçº¦æ¡ˆä¾‹,æ¥å±•å¼€æè¿°åœ¨solanaä¸Šå¼€å‘æ™ºèƒ½åˆçº¦è¦å¤„ç†å“ªäº›ç»†èŠ‚.\nExample Escrow AliceæŒæœ‰token X, BobæŒæœ‰token Y,ä»–ä»¬äº’ç›¸ä¹‹é—´è¾¾æˆäº†äº¤æ˜“çº¦å®š: Alice æ”¯ä»˜100X,å’ŒBobæ‰‹é‡Œ50Yè¿›è¡Œå…‘æ¢.å’Œæˆ‘ä»¬è´­ç‰©ä½¿ç”¨æ·˜å®ä¸€æ ·,Aliceå’ŒBobéƒ½å®³æ€•äº¤é’±ä¸å‘,æ‰€ä»¥éœ€è¦ä¸€ä¸ªèƒ½å……å½“æ”¯ä»˜å®çš„æ™ºèƒ½åˆä½œä½œä¸ºä¸€ä¸ªå¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æ‰˜ç®¡,è¿™å°±æ˜¯æˆ‘ä»¬æ¡ˆä¾‹: Escrow.\nç›´è§‚çš„å»æƒ³,è®©Aliceå‘èµ·äº¤æ˜“çš„æ—¶å€™è½¬è´¦ç»™åˆçº¦å°±è¡Œ,è®©Bobåç»­å»æ‰¾åˆçº¦æ‹¿é’±.ä½†è¿™æ˜¯ä¼ ç»Ÿæ”¯ä»˜å®çš„åšæ³•:æ”¯ä»˜å®æ‹¥æœ‰ä¸€ä¸ªå·¨å¤§çš„æ•°æ®åº“,å¯ä»¥é€šè¿‡é”®å€¼çš„æ–¹å¼è®°å½•ä¸‹ä¸åŒæ•°ä»¥äº¿è®¡çš„ç”¨æˆ·çš„äº¤æ˜“å¯¹.åœ¨solanaä¸Š,æ™ºèƒ½åˆçº¦çš„æ•°æ®å­˜å‚¨æ˜¯é€šè¿‡accountæ¥å®ç°çš„,è€Œæ¯ä¸€ä¸ªaccountæœ€å¤šåªèƒ½æä¾›32KBçš„æ•°æ®å­˜å‚¨,æ— æ³•å­˜å‚¨è·Ÿåˆçº¦æ— å…³çš„ç”¨æˆ·æ•°æ®.\nsolanaå¹¶ä¸æ˜¯æ²¡æœ‰é¢„è§åˆ°è¿™ç‚¹,å…¶æä¾›çš„PDA(ç¨‹åºå§”æ‰˜è´¦æˆ·)èƒ½ä»£æˆ‘ä»¬åšåˆ°è®°å½•æ— é™çš„æ•°æ®è´¦æˆ·â€“å½“ç”¨æˆ·ä¸åˆçº¦äº¤æ˜“æ—¶,ä¸ºå…¶ç”Ÿæˆä¸“å±çš„accountæ¥å­˜å‚¨äº¤æ˜“ç»†èŠ‚.å½“Aliceå’Œæ™ºèƒ½åˆçº¦äº’åŠ¨çš„æ—¶å€™, æ™ºèƒ½åˆçº¦é€šè¿‡ç¡®å®šçš„ç§å­ç”Ÿæˆä¸€ä¸ªPDAè´¦æˆ·æ¥å¤„ç†è¿™ç¬”äº¤æ˜“.\ngraph LR: Alice - è®©æˆ‘ä»¬å±•å¼€,ä¸€ç‚¹ç‚¹çš„æ‹ä¸‹å®ç°ç»†èŠ‚.\nSetting up the project æˆ‘ä»¬å¯ä»¥å‚ç…§è¿™ä¸ªæ¡ˆä¾‹åˆ›å»ºä¸€ä¸ªrustçš„é¡¹ç›®,æˆ‘ä»¬ä¿®æ”¹Cargo.toml,è®©å…¶çŸ¥é“æˆ‘ä»¬éœ€è¦çš„ä¾èµ–å’Œç¼–è¯‘ç»“æœäº§å‡º.\n[package] name = \"solana-escrow\" version = \"0.1.0\" edition = \"2021\" license = \"WTFPL\" publish = false [dependencies] solana-program = \"1.9.4\" [lib] crate-type = [\"cdylib\", \"lib\"] entrypoint.rs, program, and accounts ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨ç€æ‰‹ç¼–å†™è¿™ä¸ªæ™ºèƒ½åˆçº¦äº†!å¦‚æˆ‘ä»¬æ‰€è§,æœ€åç¼–è¯‘æˆeBPFçš„ç¨‹åº,å…¥å£å¤„åœ¨lib.rsä¸­,æˆ‘ä»¬é€šè¿‡useæ¥å¼•å…¥ä»»ä½•è¢«å¯¼å…¥çš„å‡½æ•°,é€šè¿‡entrypoint!è¿™ä¸ªå®æ¥å®šä¹‰process_instructionå‡½æ•°.è¿™æ˜¯å”¯ä¸€è°ƒç”¨æ™ºèƒ½åˆçº¦çš„æ–¹æ³•,æ‰€æœ‰çš„åˆçº¦è°ƒç”¨éƒ½æ˜¯é€šè¿‡entrypointæ¥è§¦å‘.\n è¢«è°ƒç”¨çš„æ—¶å€™, programè¢«ä¼ é€’ç»™BPF Loader. ä¸åŒçš„BPF Loaderéœ€è¦ä¸åŒçš„entrypoint\n è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†entrypoint.rs,ç”¨æ¥è®¾ç½®ç¨‹åºçš„å…¥å£\nuse solana_program::{entrypoint, entrypoint::ProgramResult, pubkey::Pubkey, account_info::AccountInfo}; use crate::process::Processor; entrypoint!(process_instruction); fn process_instruction( program_id: \u0026Pubkey, accounts: \u0026[AccountInfo], instruction_data: \u0026[u8], ) - ProgramResult { Processor::process(program_id, accounts, instruction_data) } process_instructionä½œä¸ºå…¥å£å‡½æ•°,æˆ‘ä»¬çœ‹åˆ°å…¶æ¥å—äº†ä¸‰ä¸ªå…¥å‚. program_idæ˜¯è¿™ä¸ªprogramçš„åœ°å€,åœ¨åé¢ä¼šè§£é‡Šä¸ºä»€ä¹ˆè¦åœ¨ç¨‹åºå†…éƒ¨è®¿é—®å®ƒ. instruction_dataæ˜¯è°ƒç”¨è€…ä¼ é€’ç»™ç¨‹åºçš„æ•°æ®,å¯ä»¥æ˜¯ä»»ä½•æ•°æ®. è€Œaccountsæ•°ç»„,åˆ™å’Œsolanaçš„ç¼–ç¨‹æ¨¡å‹å¯†åˆ‡å…³è”.æˆ‘é—¨éœ€è¦accountçš„åŸå› æ˜¯:\n solana program æ˜¯æ— çŠ¶æ€çš„\n å¦‚æœæˆ‘ä»¬æƒ³è¦å­˜å‚¨çŠ¶æ€,å°±éœ€è¦ä½¿ç”¨è´¦æˆ·. æˆ‘ä»¬çš„programæœ¬èº«å­˜å‚¨åœ¨è´¦æˆ·ä¸­,å…¶è¢«æ ‡è®°ä¸ºå¯ä»¥è¢«æ‰§è¡Œ.è´¦æˆ·å¯ä»¥ä¿å­˜æ•°æ®å’Œsolä»£å¸.æ¯ä¸ªè´¦æˆ·æœ‰ä¸€ä¸ªæ‰€æœ‰è€…,è¿™ä¸ªæ‰€æœ‰è€…å¯ä»¥å¯¹è´¦æˆ·æ‰£æ¬¾æˆ–è€…è°ƒæ•´å…¶ä¸­å¯¹æ•°æ®.\n accounts åªèƒ½è¢« program æ‰€æœ‰\n è¿™ä¸ªæ—¶å€™ä½ ä¼šæ„è¯†åˆ°: ä½ è‡ªå·±çš„solè´¦æˆ·å®é™…ä¸Šå¹¶ä¸å±äºä½ . ä½†æ­¤æ—¶,ä½ çš„èµ„é‡‘ä»ç„¶æ˜¯å®‰å…¨çš„. å› ä¸ºæ‰€æœ‰çš„soläº¤æ˜“éƒ½æ˜¯ç”±system programå¤„ç†çš„.äº‹å®ä¸Š,ç¨‹åºä¹Ÿæ˜¯ç”±ç¨‹åºæ‰€æœ‰.ç¨‹åºè¢«å­˜å‚¨åœ¨è´¦æˆ·ä¹‹ä¸­,è¿™äº›å¯æ‰§è¡Œè´¦æˆ·è¢«BPF Loaderæ‰€æœ‰. å”¯ä¸€ä¸å±äºBPF Loaderçš„æ˜¯, BPF Loader å’Œ system program.ä»–ä»¬æ˜¯NativeLoaderçš„é—¨å¾’,å¹¶æ‹¥æœ‰ç‰¹æ®Šæƒé™,æ¯”å¦‚åˆ†é…å†…å­˜,æ ‡è®°è´¦æˆ·ä¸ºå¯æ‰§è¡Œ.\n ç†è®ºä¸Šï¼Œç¨‹åºå¯¹å…¶æ‹¥æœ‰çš„è´¦æˆ·æœ‰å®Œå…¨çš„è‡ªä¸»æƒã€‚ç”±ç¨‹åºçš„åˆ›å»ºè€…æ¥é™åˆ¶è¿™ç§è‡ªä¸»æƒï¼Œå¹¶ç”±ç¨‹åºçš„ç”¨æˆ·æ¥éªŒè¯ç¨‹åºçš„åˆ›å»ºè€…æ˜¯å¦çœŸçš„è¿™æ ·åšäº†ã€‚ æ‰€æœ‰è¦è¯»å–æˆ–å†™å…¥çš„è´¦æˆ·éƒ½å¿…é¡»ä¼ å…¥entrypointå‡½æ•°ä¸­\n è¿™å…è®¸è¿è¡Œæ—¶å°†äº‹åŠ¡å¹¶è¡ŒåŒ–ã€‚å¦‚æœè¿è¡Œæ—¶çŸ¥é“æ‰€æœ‰å°†è¢«å†™å…¥å’Œè¢«æ¯ä¸ªäººåœ¨ä»»ä½•æ—¶å€™è¯»å–çš„è´¦æˆ·ï¼Œå®ƒå¯ä»¥å¹¶è¡Œè¿è¡Œé‚£äº›ä¸æ¥è§¦ç›¸åŒè´¦æˆ·çš„äº‹åŠ¡ï¼Œæˆ–è€…æ¥è§¦ç›¸åŒè´¦æˆ·ä½†åªè¯»ä¸å†™ã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡è¿åäº†è¿™ä¸€çº¦æŸï¼Œå‘ä¸€ä¸ªè¿è¡Œæ—¶æ²¡æœ‰è¢«é€šçŸ¥çš„è´¦æˆ·è¯»æˆ–å†™ï¼Œé‚£ä¹ˆè¯¥äº‹åŠ¡å°†å¤±è´¥ã€‚\nç°åœ¨ï¼Œä¸ºäº†æœ€åç»“æŸæœ¬èŠ‚ï¼Œåœ¨lib.rsæ—è¾¹åˆ›å»ºä¸€ä¸ªæ–°çš„entrypoint.rsæ–‡ä»¶ï¼Œå¹¶å°†lib.rsçš„ä»£ç ç§»åˆ°é‚£é‡Œã€‚æœ€åï¼Œåœ¨lib.rså†…æ³¨å†Œentrypointæ¨¡å—ã€‚ä½ å¿…é¡»å¯¹æˆ‘ä»¬åˆ›å»ºçš„æ‰€æœ‰æ–‡ä»¶éƒ½è¿™æ ·åšã€‚\ntheory recap ğŸ“š\neach program is processed by its BPF Loader and has an entrypoint whose structure depends on which BPF Loader is used accounts are used to store state accounts are owned by programs only the account owner may debit an account and adjust its data all accounts to be written to or read must be passed into the entrypoint\nAliceâ€™s transaction instruction å‰ä¸€æ®µä¸­æˆ‘ä»¬åˆ›å»ºäº†entrypoint.rs,æè¿°äº†ç¨‹åºçš„å…¥å£,ç°åœ¨æˆ‘ä»¬åˆ›å»ºinstruction.rs,æ¥ä¸ºç¨‹åºå®ç°API. ä¸ºäº†é¦–å…ˆæœ‰ä¸ªæ€»ä½“å°è±¡,æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹solana çš„programç»“æ„:\n. â”œâ”€ src â”‚ â”œâ”€ lib.rs - registering modules â”‚ â”œâ”€ entrypoint.rs - entrypoint to the program â”‚ â”œâ”€ instruction.rs - program API, (de)serializing instruction data â”‚ â”œâ”€ processor.rs - program logic â”‚ â”œâ”€ state.rs - program objects, (de)serializing state â”‚ â”œâ”€ error.rs - program specific errors â”œâ”€ .gitignore â”œâ”€ Cargo.lock â”œâ”€ Cargo.toml â”œâ”€ Xargo.toml æè¿°æµç¨‹çš„è¯æ˜¯è¿™æ ·çš„:\n ç”¨æˆ·è°ƒç”¨entrypoint entrypointè½¬å‘å‚æ•°åˆ°processor processor è¦æ±‚ instructionè§£ç entrypointä¼ å…¥çš„instruction_data ä½¿ç”¨è¢«è§£ç çš„æ•°æ®,processorä¼šå†³å®šç”¨ä»€ä¹ˆå‡½æ•°å¤„ç†è¯·æ±‚ processorå¯ä»¥ä½¿ç”¨state.rså°†çŠ¶æ€ç¼–ç åˆ°å·²ä¼ å…¥entrypointçš„è´¦æˆ·ä¸­ï¼Œæˆ–å¯¹è´¦æˆ·çš„çŠ¶æ€è¿›è¡Œè§£ç ã€‚  æ ¸å¿ƒæ˜¯:\n instruction.rs defines the â€œAPIâ€ of a program\n å›åˆ°escrow\nAliceå’ŒBobçš„ä¸»è´¦æˆ·éƒ½æ˜¯system_programçš„è´¦æˆ·,è€Œä»–ä»¬æƒ³äº¤æ˜“çš„token,ç”±token programåˆ›å»º.ä»–ä»¬è¦æŒæœ‰token,å°±éœ€è¦æ‹¥æœ‰ç”±token programåˆ›å»ºçš„è´¦æˆ·. Aliceå’ŒBobéƒ½éœ€è¦æŒæœ‰å¯¹æ–¹è¦äº¤æ˜“çš„tokençš„ç‰¹åˆ«è´¦æˆ·æ‰èƒ½å®Œæˆäº¤æ˜“,æ‰€ä»¥åœ¨Aliceå’ŒBobçš„äº¤æ˜“å¯¹ä¸­,æˆ‘ä»¬è‡³å°‘è¦æœ‰4ä¸ªè´¦æˆ·.\ntoken ownership \u0026\u0026 transfer ownership å¦‚æœä¸ºäº†æ‰§è¡Œäº¤æ˜“,Aliceå’ŒBobéƒ½æŒæœ‰ä¸åŒçš„tokenè´¦æˆ·,è®°ä½ä¸åŒçš„tokenå¯†é’¥å»æ‰§è¡Œäº¤æ˜“,æœªå…å¤ªè¿‡ç¹ç.solanaçš„ä»£å¸ç¨‹åºè§„é¿äº†è¿™ç§æ–¹å¼: token(ä»£å¸)è´¦æˆ·çš„æ‰€æœ‰è€…åªèƒ½æ˜¯programæœ¬èº«,è€Œtokenæœ¬èº«çš„æ‰€æœ‰è€…,è¯¸å¦‚aliceè¿˜æœ‰Bobç­‰ç”¨æˆ·,åˆ™æ˜¯programåœ¨ç”¨æˆ·ç©ºé—´å£°æ˜çš„æ•°æ®,æ•°æ®è¢«ç¼–ç åœ¨ä»£å¸è´¦æˆ·ä¸­,æ­¤å¤–è¿˜æœ‰å…¶ä»–å±æ€§,å¦‚è´¦æˆ·æŒæœ‰çš„ä»£å¸ä½™é¢. æ‰€æœ‰,åç»­ä¼šå°†tokençš„æ‰€æœ‰è€…è¢«ç§°ä¸ºauthority,è€Œsolanaå†…éƒ¨çš„tokenæ‰€æœ‰è€…è¢«ç§°ä¸ºowner.è¿™å…¶å®æ­ç¤ºäº†solanaçš„tokenæ‰€æœ‰æƒæœºåˆ¶:\n All internal Solana internal account information are saved into fields on the account (opens new window)but never into the data field which is solely meant for user space information æ‰€æœ‰Solanaå†…éƒ¨è´¦æˆ·çš„ä¿¡æ¯éƒ½è¢«ä¿å­˜åœ¨è´¦æˆ·çš„å­—æ®µä¸­ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰ï¼Œä½†ç»ä¸ä¼šä¿å­˜åœ¨æ•°æ®å­—æ®µä¸­ï¼Œå› ä¸ºæ•°æ®å­—æ®µåªç”¨äºç”¨æˆ·ç©ºé—´ä¿¡æ¯\n ä¸‹å›¾ç®€å•çš„æè¿°äº† â€œç”¨æˆ·ç©ºé—´â€ ä¸­tokençš„æ‰€æœ‰æƒ. Aliceä¸ºäº†ä½¿ç”¨ä¸€éƒ¨åˆ†tokenä¸Bobè¿›è¡Œäº¤æ˜“,å¥¹åˆ›å»ºäº†ä¸€ä¸ªå…³äºX tokençš„ä¸´æ—¶è´¦æˆ·,å¹¶å‘å…¶è½¬ç§»äº¤æ˜“é‡çš„token,éšåå¥¹è°ƒç”¨token programä¸­çš„å‡½æ•°,å°†è¿™ä¸ªä¸´æ—¶çš„æ‰€æœ‰æƒè½¬ç§»åˆ°äº†æ‰˜ç®¡ç¨‹åºä¸­.è€Œè¿™ä¸ªæ‰˜ç®¡ç¨‹åº,å°±æ˜¯åé¢è¦æ¶‰åŠåˆ°çš„åˆçº¦ä¸ºå…¶ç”Ÿæˆçš„PDA. ç»§ç»­å›åˆ° Instruction // inside instruction.rs pub enum EscrowInstruction { /// Starts the trade by creating and populating an escrow account and transferring ownership of the given temp token account to the PDA  ///  ///  /// Accounts expected:  ///  /// 0. `[signer]` The account of the person initializing the escrow  /// 1. `[writable]` Temporary token account that should be created prior to this instruction and owned by the initializer  /// 2. `[]` The initializer's token account for the token they will receive should the trade go through  /// 3. `[writable]` The escrow account, it will hold all necessary info about the trade.  /// 4. `[]` The rent sysvar  /// 5. `[]` The token program  InitEscrow { /// The amount party A expects to receive of token Y  amount: u64 } } å›åˆ°instruction,æˆ‘ä»¬å…ˆæ·»åŠ ç¬¬ä¸€ä¸ªæŒ‡ä»¤.é€šè¿‡è¿™ä¸ªæŒ‡ä»¤,Aliceå¯ä»¥åˆå§‹åŒ–å¥¹æƒ³æ‰§è¡Œçš„äº¤æ˜“.\næ³¨æ„,///è¿™ç§æ³¨é‡Šä¸ä¼šå½±å“åˆ°ä»£ç . writableæ ‡å¿—æ„å‘³ç€,è°ƒç”¨ä¼šå°è¯•å†™è´¦æˆ·,å¦‚æœå¤±è´¥äº†é‚£ä¹ˆäº¤æ˜“ä¼šå¤±è´¥.\nè®¾: Aliceå‘èµ·äº¤æ˜“å­˜å…¥token Xå¹¶è®¾ç½®éœ€è¦çš„token Yæ•°é‡, ç¨åBobä¼šæ‹¿token Yå»æ‰§è¡Œäº¤æ˜“ é‚£ä¹ˆ, Aliceé¦–å…ˆè°ƒç”¨ InitEscrow,è¿™æ¡æŒ‡ä»¤æœŸå¾…çš„Accountså°±å¦‚ä¸‹æ‰€ç¤º: 0. [signer] è¢«ç”¨æ¥äº¤æ˜“æŒæœ‰tokenæ‰€æœ‰æƒçš„ä¸´æ—¶è´¦æˆ·,å…¶éœ€è¦Aliceçš„ç­¾å,æ‰€ä»¥è¿™æ˜¯Aliceçš„åœ°å€,å£°æ˜äº†ç­¾åäººæ˜¯è°\n éœ€è¦è¢«å†™å…¥çš„ temp token X account aliceâ€˜s token Y account ä¸€ä¸ªå¯å†™çš„escrow account rent sysvar ç§Ÿé‡‘è´¦æˆ·å˜é‡ token program  éšåæˆ‘ä»¬å®ç°instructionå¯¹instruction_dataçš„è§£ç æ“ä½œ:\n// inside instruction.rs use std::convert::TryInto; use solana_program::program_error::ProgramError; use crate::error::EscrowError::InvalidInstruction; pub enum EscrowInstruction { InitEscrow { /// The amount party A expects to receive of token Y  amount: u64 } } impl EscrowInstruction { /// Unpacks a byte buffer into a [EscrowInstruction](enum.EscrowInstruction.html).  pub fn unpack(input: \u0026[u8]) - ResultSelf, ProgramError { let (tag, rest) = input.split_first().ok_or(InvalidInstruction)?; Ok(match tag { 0 = Self::InitEscrow { amount: Self::unpack_amount(rest)?, }, _ = return Err(InvalidInstruction.into()), }) } fn unpack_amount(input: \u0026[u8]) - Resultu64, ProgramError { let amount = input .get(..8) .and_then(|slice| slice.try_into().ok()) .map(u64::from_le_bytes) .ok_or(InvalidInstruction)?; Ok(amount) } } unpackå®ç°äº†è§£æ\u0026[u8] (ä¸€ä¸ªè¢«å¼•ç”¨çš„u8æ•°ç»„).è¿™é‡Œ,u8æ•°ç»„çš„ç¬¬ä¸€ä¸ªbyteè¢«ç”¨æ¥ä½œä¸ºtagå»è¯†åˆ«ç±»å‹. unpack_amountè¿™é‡Œç”¨æ¥è·å¾—ç»“æ„ä½“ä¸­çš„amountå…·ä½“é‡‘é¢,å…¶ä»£è¡¨äº†Aliceæƒ³è¦è·å¾—çš„token Yæ•°é‡.\nprocess.rs èƒ½è§£æç”¨æˆ·è°ƒç”¨æ•°æ®å,æˆ‘ä»¬å¼€å§‹ç¼–å†™processor,æ¥å®ç°åˆçº¦æ“ä½œ.\nuse solana_program::{ account_info::AccountInfo, entrypoint::ProgramResult, msg, pubkey::Pubkey, }; use crate::instruction::EscrowInstruction; pub struct Processor; impl Processor { pub fn process(program_id: \u0026Pubkey, accounts: \u0026[AccountInfo], instruction_data: \u0026[u8]) - ProgramResult { let instruction = EscrowInstruction::unpack(instruction_data)?; match instruction { EscrowInstruction::InitEscrow { amount } = { msg!(\"Instruction: InitEscrow\"); //æ—¥å¿—ä¿¡æ¯  Self::process_init_escrow(accounts, amount, program_id) } } } } è¿™æ®µä»£ç é€»è¾‘æ¯”è¾ƒç®€å•,åœ¨æ¥å—åˆ°æŒ‡ä»¤å,è§£ææˆæ•°æ®,æ‰§è¡Œå¯¹åº”çš„processer.\nfn process_init_escrow âš ï¸å‰æ–¹å¤§é‡ä»£ç è­¦å‘Šâš ï¸\nDonâ€™t Panic, æˆ‘ä¼šåœ¨æ³¨é‡Šé‡Œé¢è®²æ¸…æ¥š\nuse solana_program::{ account_info::{next_account_info, AccountInfo}, entrypoint::ProgramResult, program_error::ProgramError, msg, pubkey::Pubkey, }; ... fn process_init_escrow( accounts: \u0026[AccountInfo], amount: u64, program_id: \u0026Pubkey, ) - ProgramResult { let account_info_iter = \u0026mut accounts.iter(); ///å¼€å¯è´¦æˆ·è¿­ä»£å™¨! è®¾ç½®ä¸ºmutableæ˜¯ä¸ºäº†å¯ä»¥ç§»åŠ¨è´¦æˆ·çš„æ‰€æœ‰æƒ  let initializer = next_account_info(account_info_iter)?; //Alice main account,åœ¨è¿™ç¬”äº¤æ˜“ä¸­,å¥¹éœ€è¦æ˜¯ä¸€ä¸ªsigner  if !initializer.is_signer { return Err(ProgramError::MissingRequiredSignature); } let temp_token_account = next_account_info(account_info_iter)?; let token_to_receive_account = next_account_info(account_info_iter)?; // Q: \"why do we check that the token_to_receive_account is actually owned by the token program but don't do the same for the temp_token_account?\".  // Q: ä¸ºä»€ä¹ˆè¦æ£€æŸ¥token_to_receive_accountæ˜¯å¦çœŸçš„ä¸ºtokenç¨‹åºæ‰€æœ‰?è€Œä¸æ˜¯å¯¹temp_token_accountåšåŒæ ·çš„æ£€æŸ¥?  // A: åœ¨å‡½æ•°çš„åé¢ï¼Œæˆ‘ä»¬å°†è¦æ±‚ä»¤ç‰Œç¨‹åºå°†temp_token_accountçš„æ‰€æœ‰æƒè½¬ç§»ç»™PDAã€‚å¦‚æœtemp_token_accountä¸å±äºtokenç¨‹åºï¼Œé‚£ä¹ˆè¿™ä¸ªè½¬ç§»å°±ä¼šå¤±è´¥ï¼Œ  // åªæœ‰è´¦æˆ·çš„æ‹¥æœ‰è€…å¯ä»¥ä¿®æ”¹è´¦æˆ·  if *token_to_receive_account.owner != spl_token::id() { return Err(ProgramError::IncorrectProgramId); } //  let escrow_account = next_account_info(account_info_iter)?; let rent = \u0026Rent::from_account_info(next_account_info(account_info_iter)?)?; // å…ç§Ÿç§Ÿé‡‘  if !rent.is_exempt(escrow_account.lamports(), escrow_account.data_len()) { return Err(EscrowError::NotRentExempt.into()); } let mut escrow_info = Escrow::unpack_unchecked(\u0026escrow_account.try_borrow_data()?)?; if escrow_info.is_initialized() { return Err(ProgramError::AccountAlreadyInitialized); } escrow_info.expected_amount = amount; Escrow::pack(escrow_info, \u0026mut escrow_account.try_borrow_mut_data()?)?; let (pda, _bump_seed) = Pubkey::find_program_address(\u0026[b\"escrow\"], program_id); let token_program = next_account_info(account_info_iter)?; let owner_change_ix = spl_token::instruction::set_authority( token_program.key, temp_token_account.key, Some(\u0026pda), AuthorityType::AccountOwner, initializer.key, \u0026[\u0026initializer.key], )?; invoke( \u0026owner_change_ix, \u0026[ temp_token_account.clone(), initializer.clone(), token_program.clone(), ], )?; Ok(()) } rentsysvarå‡ºç°åœ¨äº†processçš„è¿‡ç¨‹ä¸­.\n Rent is deducted from an accountâ€™s balance according to their space requirements (i.e. the space an account and its fields take up in memory) regularly. An account can, however, be made rent-exempt if its balance is higher than some threshold that depends on the space itâ€™s consuming\n Aliceè½¬è´¦è¿‡ç¨‹ä¸­å¼€äº†ä¸ªè´¦æˆ·,åœ¨ç§Ÿé‡‘ä¸Šä¸æ˜¯å…ç§Ÿçš„,å¥¹ä»¥æ­¤å‘Bobå‘èµ·äº†äº¤æ˜“. Bobå½“æ—¶æ²¡æœ‰æ”¶å–,åå¹´å,Aliceå‘Bobå‘é€çš„1000ä¸ªX tokenç°åœ¨èƒ½æ¢åä¸ªäº¿äº†,Bobæƒ³èµ·æ¥è‡ªå·±æœ‰ä¸ªæš´å¯Œçš„æœºä¼šå†³å®šå»æ”¶å–,ä½†æ˜¯è´¦æˆ·å› ä¸ºç§Ÿé‡‘ä¸æ˜¯å…ç§Ÿçš„,è¢«solanaç³»ç»Ÿå¹²æ‰äº†.\nè¿™åˆç†å—?è¿™ä¸åˆç†.\næ›´ä½•å†µ,ç°åœ¨ç§Ÿé‡‘å‡ ä¹æ˜¯ä¸¤åˆ°ä¸‰å¤©ä¸€æ”¶(epoch),å¦‚æœä¸æ˜¯å…ç§Ÿçš„,å¾ˆå¿«å°±ä¼šè¿™æ ·æ„å¤–çš„burnæ‰äº†token,è¿™æ˜¯ä¸å¯é¢„æœŸçš„é”™è¯¯è¡Œä¸º. æ‰€ä»¥ä¸ºäº†äº¤æ˜“çš„å®‰å…¨,aliceå¿…é¡»å‘è¿™ä¸ªè´¦æˆ·å­˜å¤Ÿèƒ½è®©å…¶å…ç§Ÿçš„sol/lamports.\næœ€åè®°å¾—\n[dependencies] solana-program = \"1.9.4\" spl-token = {version = \"3.2.0\", features = [\"no-entrypoint\"]} error.rs ... [dependencies] solana-program = \"1.9.4\" spl-token = {version = \"3.2.0\", features = [\"no-entrypoint\"]} thiserror = \"1.0.24\" // inside error.rs use thiserror::Error; use solana_program::program_error::ProgramError; #[derive(Error, Debug, Copy, Clone)] pub enum EscrowError { /// Invalid instruction  #[error(\"Invalid Instruction\")] InvalidInstruction, } impl FromEscrowError for ProgramError { fn from(e: EscrowError) - Self { ProgramError::Custom(e as u32) } } state.rs use solana_program::pubkey::Pubkey; pub struct Escrow { pub is_initialized: bool, pub initializer_pubkey: Pubkey, pub temp_token_account_pubkey: Pubkey, pub initializer_token_to_receive_account_pubkey: Pubkey, pub expected_amount: u64, } CPIs Program Derived Address PDAs Bobâ€˜s Transaction Anchor èµ°å®Œä¸Šé¢çš„æµç¨‹,æ˜¯ä¸æ˜¯æ„Ÿå—åˆ°äº†ç²—é™‹å’Œç¹ç?\nä¼ è¾“æ•°æ®ç”¨çš„æ˜¯æœ€åŸºæœ¬çš„Accountsæ•°ç»„/u8æ•°ç»„,ä¸ºäº†æ‹¿åˆ°æ•°æ®,æˆ‘ä»¬è¦é€šè¿‡è®¡ç®—æ•°æ®çš„é•¿åº¦,ä¸€ä¸ªä¸ªå–å‡ºæ¥å¹¶å¼ºå£®,è¿™çœ‹èµ·æ¥å¹¶ä¸åƒæ˜¯ç°ä»£äººä¼šå¹²çš„äº‹æƒ….\næ‰€ä»¥è¿™é‡Œä»‹ç»ä¸€ä¸‹Anchor,å…¶å°†ä¹‹å‰ç¹çæ­¥éª¤ä¸­ä¸æ–­é‡å¤çš„ç»å¤§å¤šæ•°éƒ½ç”¨å®åšäº†åŒ–ç®€,æ¥é™ä½æˆ‘ä»¬å¯æ€œçš„1500mlå·¦å³çš„çš„è„‘æµ†ä¸Šçš„å¿ƒæ™ºè´Ÿæ‹….\nAnchor install  å‚è€ƒ  Programming on Solana - An Introduction  ","wordCount":"947","inLanguage":"en","datePublished":"2022-08-30T13:22:27+08:00","dateModified":"2022-08-30T13:22:27+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.explosion.zip/posts/solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8C%97/"},"publisher":{"@type":"Organization","name":"ç¬”è®°","logo":{"@type":"ImageObject","url":"https://blog.explosion.zip/%3Clink%20/%20abs%20url%3E"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://blog.explosion.zip/ accesskey=h title="ç¬”è®° (Alt + H)">ç¬”è®°</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://blog.explosion.zip/categories/ title=categories>
<span>categories</span>
</a>
</li>
<li>
<a href=https://blog.explosion.zip/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://blog.explosion.zip/>Home</a>&nbsp;Â»&nbsp;<a href=https://blog.explosion.zip/posts/>Posts</a></div>
<h1 class=post-title>
Solanaåˆçº¦å¼€å‘æŒ‡åŒ—
</h1>
<div class=post-meta><span title="2022-08-30 13:22:27 +0800 +0800">August 30, 2022</span>&nbsp;Â·&nbsp;5 min&nbsp;Â·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/solana%e5%90%88%e7%ba%a6%e5%bc%80%e5%8f%91%e6%8c%87%e5%8c%97.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header>
<div class=post-content><h1 id=solanaåˆçº¦å¼€å‘æŒ‡åŒ—>Solanaåˆçº¦å¼€å‘æŒ‡åŒ—<a hidden class=anchor aria-hidden=true href=#solanaåˆçº¦å¼€å‘æŒ‡åŒ—>#</a></h1>
<p>è¿™é‡Œå‡å®šsolanaéœ€è¦çš„å¼€å‘ç¯å¢ƒ: rust/node.jsç”šè‡³Solanaå®¢æˆ·ç«¯éƒ½å·²ç»è£…å¥½äº†.</p>
<p>åˆçº¦æ˜¯ä»€ä¹ˆ?ç®€å•æ¥è¯´,å°±æ˜¯åœ¨æä¾›å¤šä¸ªå‡½æ•°rpcè°ƒç”¨å,ç”¨æˆ·è¾“å…¥ç¬¦åˆç‰¹å®šéœ€æ±‚çš„ç»“æ„ä½“æ•°æ®å,è·å¾—é¢„æœŸçš„ç»“æœæˆ–è€…ç¬¦åˆè§„åˆ™çš„é”™è¯¯.åŒæ—¶æä¾›åœ¨å¯æ¥å—çš„å¤æ‚åº¦èŒƒå›´å†…,å­˜å‚¨å°‘é‡æœ‰å…³ç”¨æˆ·çš„å…ƒæ•°æ®.</p>
<blockquote>
<p>On Solana, smart contracts are called programs</p>
</blockquote>
<p>é¦–å…ˆ,å…ˆç¡®å®šsolanaçš„ç›¸å…³æœ¯è¯­.ä¸ºäº†ç¬¦åˆå®˜æ–¹çš„ç§°è°“,solanaä¸Šçš„æ™ºèƒ½åˆçº¦éƒ½è¢«ç§°ä½œprogramsè€Œésmart contracts.<br>
éšå,æˆ‘ä»¬é¢„æƒ³ä¸€ä¸ªæ™ºèƒ½èƒ½åˆçº¦æ¡ˆä¾‹,æ¥å±•å¼€æè¿°åœ¨solanaä¸Šå¼€å‘æ™ºèƒ½åˆçº¦è¦å¤„ç†å“ªäº›ç»†èŠ‚.</p>
<h2 id=example-escrow>Example Escrow<a hidden class=anchor aria-hidden=true href=#example-escrow>#</a></h2>
<p>AliceæŒæœ‰token X, BobæŒæœ‰token Y,ä»–ä»¬äº’ç›¸ä¹‹é—´è¾¾æˆäº†äº¤æ˜“çº¦å®š: Alice æ”¯ä»˜100X,å’ŒBobæ‰‹é‡Œ50Yè¿›è¡Œå…‘æ¢.å’Œæˆ‘ä»¬è´­ç‰©ä½¿ç”¨æ·˜å®ä¸€æ ·,Aliceå’ŒBobéƒ½å®³æ€•äº¤é’±ä¸å‘,æ‰€ä»¥éœ€è¦ä¸€ä¸ªèƒ½å……å½“æ”¯ä»˜å®çš„æ™ºèƒ½åˆä½œä½œä¸ºä¸€ä¸ªå¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æ‰˜ç®¡,è¿™å°±æ˜¯æˆ‘ä»¬æ¡ˆä¾‹: Escrow.</p>
<p><img loading=lazy src=../../static/image/escrow.gif alt=Escrow>
</p>
<p>ç›´è§‚çš„å»æƒ³,è®©Aliceå‘èµ·äº¤æ˜“çš„æ—¶å€™è½¬è´¦ç»™åˆçº¦å°±è¡Œ,è®©Bobåç»­å»æ‰¾åˆçº¦æ‹¿é’±.ä½†è¿™æ˜¯ä¼ ç»Ÿæ”¯ä»˜å®çš„åšæ³•:æ”¯ä»˜å®æ‹¥æœ‰ä¸€ä¸ªå·¨å¤§çš„æ•°æ®åº“,å¯ä»¥é€šè¿‡é”®å€¼çš„æ–¹å¼è®°å½•ä¸‹ä¸åŒæ•°ä»¥äº¿è®¡çš„ç”¨æˆ·çš„äº¤æ˜“å¯¹.åœ¨solanaä¸Š,æ™ºèƒ½åˆçº¦çš„æ•°æ®å­˜å‚¨æ˜¯é€šè¿‡accountæ¥å®ç°çš„,è€Œæ¯ä¸€ä¸ªaccountæœ€å¤šåªèƒ½æä¾›32KBçš„æ•°æ®å­˜å‚¨,æ— æ³•å­˜å‚¨è·Ÿåˆçº¦æ— å…³çš„ç”¨æˆ·æ•°æ®.</p>
<p>solanaå¹¶ä¸æ˜¯æ²¡æœ‰é¢„è§åˆ°è¿™ç‚¹,å…¶æä¾›çš„PDA(ç¨‹åºå§”æ‰˜è´¦æˆ·)èƒ½ä»£æˆ‘ä»¬åšåˆ°è®°å½•æ— é™çš„æ•°æ®è´¦æˆ·&ndash;å½“ç”¨æˆ·ä¸åˆçº¦äº¤æ˜“æ—¶,ä¸ºå…¶ç”Ÿæˆä¸“å±çš„accountæ¥å­˜å‚¨äº¤æ˜“ç»†èŠ‚.å½“Aliceå’Œæ™ºèƒ½åˆçº¦äº’åŠ¨çš„æ—¶å€™, æ™ºèƒ½åˆçº¦é€šè¿‡ç¡®å®šçš„ç§å­ç”Ÿæˆä¸€ä¸ªPDAè´¦æˆ·æ¥å¤„ç†è¿™ç¬”äº¤æ˜“.</p>
<pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR:
    Alice -&gt; 
</code></pre><p>è®©æˆ‘ä»¬å±•å¼€,ä¸€ç‚¹ç‚¹çš„æ‹ä¸‹å®ç°ç»†èŠ‚.</p>
<h2 id=setting-up-the-project>Setting up the project<a hidden class=anchor aria-hidden=true href=#setting-up-the-project>#</a></h2>
<p>æˆ‘ä»¬å¯ä»¥å‚ç…§è¿™ä¸ª<a href=https://github.com/mvines/solana-bpf-program-template>æ¡ˆä¾‹</a>åˆ›å»ºä¸€ä¸ªrustçš„é¡¹ç›®,æˆ‘ä»¬ä¿®æ”¹<code>Cargo.toml</code>,è®©å…¶çŸ¥é“æˆ‘ä»¬éœ€è¦çš„ä¾èµ–å’Œç¼–è¯‘ç»“æœäº§å‡º.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[<span style=color:#a6e22e>package</span>]
<span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;solana-escrow&#34;</span>
<span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.1.0&#34;</span>
<span style=color:#a6e22e>edition</span> = <span style=color:#e6db74>&#34;2021&#34;</span>
<span style=color:#a6e22e>license</span> = <span style=color:#e6db74>&#34;WTFPL&#34;</span>
<span style=color:#a6e22e>publish</span> = <span style=color:#66d9ef>false</span>

[<span style=color:#a6e22e>dependencies</span>]
<span style=color:#a6e22e>solana-program</span> = <span style=color:#e6db74>&#34;1.9.4&#34;</span>

[<span style=color:#a6e22e>lib</span>]
<span style=color:#a6e22e>crate-type</span> = [<span style=color:#e6db74>&#34;cdylib&#34;</span>, <span style=color:#e6db74>&#34;lib&#34;</span>]
</code></pre></div><h2 id=entrypointrs-program-and-accounts>entrypoint.rs, program, and accounts<a hidden class=anchor aria-hidden=true href=#entrypointrs-program-and-accounts>#</a></h2>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨ç€æ‰‹ç¼–å†™è¿™ä¸ªæ™ºèƒ½åˆçº¦äº†!å¦‚æˆ‘ä»¬æ‰€è§,æœ€åç¼–è¯‘æˆeBPFçš„ç¨‹åº,å…¥å£å¤„åœ¨<code>lib.rs</code>ä¸­,æˆ‘ä»¬é€šè¿‡<code>use</code>æ¥å¼•å…¥ä»»ä½•è¢«å¯¼å…¥çš„å‡½æ•°,é€šè¿‡<code>entrypoint!</code>è¿™ä¸ªå®æ¥å®šä¹‰<code>process_instruction</code>å‡½æ•°.è¿™æ˜¯å”¯ä¸€è°ƒç”¨æ™ºèƒ½åˆçº¦çš„æ–¹æ³•,æ‰€æœ‰çš„åˆçº¦è°ƒç”¨éƒ½æ˜¯é€šè¿‡entrypointæ¥è§¦å‘.</p>
<blockquote>
<p>è¢«è°ƒç”¨çš„æ—¶å€™, programè¢«ä¼ é€’ç»™BPF Loader. ä¸åŒçš„BPF Loaderéœ€è¦ä¸åŒçš„entrypoint</p>
</blockquote>
<p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†<code>entrypoint.rs</code>,ç”¨æ¥è®¾ç½®ç¨‹åºçš„å…¥å£</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rs data-lang=rs><span style=color:#66d9ef>use</span> solana_program::{entrypoint, entrypoint::ProgramResult, pubkey::Pubkey, account_info::AccountInfo};

<span style=color:#66d9ef>use</span> <span style=color:#66d9ef>crate</span>::process::Processor;

entrypoint<span style=color:#f92672>!</span>(process_instruction);
<span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>process_instruction</span>(
    program_id: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>Pubkey</span>,
    accounts: <span style=color:#66d9ef>&amp;</span>[AccountInfo],
    instruction_data: <span style=color:#66d9ef>&amp;</span>[<span style=color:#66d9ef>u8</span>],
) -&gt; <span style=color:#a6e22e>ProgramResult</span> {
    Processor::process(program_id, accounts, instruction_data)
}
</code></pre></div><p><code>process_instruction</code>ä½œä¸ºå…¥å£å‡½æ•°,æˆ‘ä»¬çœ‹åˆ°å…¶æ¥å—äº†ä¸‰ä¸ªå…¥å‚. <code>program_id</code>æ˜¯è¿™ä¸ªprogramçš„åœ°å€,åœ¨åé¢ä¼šè§£é‡Šä¸ºä»€ä¹ˆè¦åœ¨ç¨‹åºå†…éƒ¨è®¿é—®å®ƒ. <code>instruction_data</code>æ˜¯è°ƒç”¨è€…ä¼ é€’ç»™ç¨‹åºçš„æ•°æ®,å¯ä»¥æ˜¯ä»»ä½•æ•°æ®. è€Œ<code>accounts</code>æ•°ç»„,åˆ™å’Œsolanaçš„ç¼–ç¨‹æ¨¡å‹å¯†åˆ‡å…³è”.æˆ‘é—¨éœ€è¦accountçš„åŸå› æ˜¯:</p>
<blockquote>
<p>solana program æ˜¯æ— çŠ¶æ€çš„</p>
</blockquote>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦å­˜å‚¨çŠ¶æ€,å°±éœ€è¦ä½¿ç”¨è´¦æˆ·. æˆ‘ä»¬çš„programæœ¬èº«å­˜å‚¨åœ¨è´¦æˆ·ä¸­,å…¶è¢«æ ‡è®°ä¸ºå¯ä»¥è¢«æ‰§è¡Œ.è´¦æˆ·å¯ä»¥ä¿å­˜æ•°æ®å’Œsolä»£å¸.æ¯ä¸ªè´¦æˆ·æœ‰ä¸€ä¸ªæ‰€æœ‰è€…,è¿™ä¸ªæ‰€æœ‰è€…å¯ä»¥å¯¹è´¦æˆ·æ‰£æ¬¾æˆ–è€…è°ƒæ•´å…¶ä¸­å¯¹æ•°æ®.</p>
<blockquote>
<p>accounts åªèƒ½è¢« program æ‰€æœ‰</p>
</blockquote>
<p>è¿™ä¸ªæ—¶å€™ä½ ä¼šæ„è¯†åˆ°: ä½ è‡ªå·±çš„solè´¦æˆ·å®é™…ä¸Šå¹¶ä¸å±äºä½ . ä½†æ­¤æ—¶,ä½ çš„èµ„é‡‘ä»ç„¶æ˜¯<a href="https://www.urbandictionary.com/define.php?term=Safu">å®‰å…¨çš„</a>. å› ä¸ºæ‰€æœ‰çš„soläº¤æ˜“éƒ½æ˜¯ç”±<code>system program</code>å¤„ç†çš„.äº‹å®ä¸Š,ç¨‹åºä¹Ÿæ˜¯ç”±ç¨‹åºæ‰€æœ‰.ç¨‹åºè¢«å­˜å‚¨åœ¨è´¦æˆ·ä¹‹ä¸­,è¿™äº›å¯æ‰§è¡Œè´¦æˆ·è¢«<code>BPF Loader</code>æ‰€æœ‰. å”¯ä¸€ä¸å±äº<code>BPF Loader</code>çš„æ˜¯, <code>BPF Loader</code> å’Œ <code>system program</code>.ä»–ä»¬æ˜¯<code>NativeLoader</code>çš„é—¨å¾’,å¹¶æ‹¥æœ‰ç‰¹æ®Šæƒé™,æ¯”å¦‚åˆ†é…å†…å­˜,æ ‡è®°è´¦æˆ·ä¸ºå¯æ‰§è¡Œ.</p>
<blockquote>
<p>ç†è®ºä¸Šï¼Œç¨‹åºå¯¹å…¶æ‹¥æœ‰çš„è´¦æˆ·æœ‰å®Œå…¨çš„è‡ªä¸»æƒã€‚ç”±ç¨‹åºçš„åˆ›å»ºè€…æ¥é™åˆ¶è¿™ç§è‡ªä¸»æƒï¼Œå¹¶ç”±ç¨‹åºçš„ç”¨æˆ·æ¥éªŒè¯ç¨‹åºçš„åˆ›å»ºè€…æ˜¯å¦çœŸçš„è¿™æ ·åšäº†ã€‚
æ‰€æœ‰è¦è¯»å–æˆ–å†™å…¥çš„è´¦æˆ·éƒ½å¿…é¡»ä¼ å…¥entrypointå‡½æ•°ä¸­</p>
</blockquote>
<p>è¿™å…è®¸è¿è¡Œæ—¶å°†äº‹åŠ¡å¹¶è¡ŒåŒ–ã€‚å¦‚æœè¿è¡Œæ—¶çŸ¥é“æ‰€æœ‰å°†è¢«å†™å…¥å’Œè¢«æ¯ä¸ªäººåœ¨ä»»ä½•æ—¶å€™è¯»å–çš„è´¦æˆ·ï¼Œå®ƒå¯ä»¥å¹¶è¡Œè¿è¡Œé‚£äº›ä¸æ¥è§¦ç›¸åŒè´¦æˆ·çš„äº‹åŠ¡ï¼Œæˆ–è€…æ¥è§¦ç›¸åŒè´¦æˆ·ä½†åªè¯»ä¸å†™ã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡è¿åäº†è¿™ä¸€çº¦æŸï¼Œå‘ä¸€ä¸ªè¿è¡Œæ—¶æ²¡æœ‰è¢«é€šçŸ¥çš„è´¦æˆ·è¯»æˆ–å†™ï¼Œé‚£ä¹ˆè¯¥äº‹åŠ¡å°†å¤±è´¥ã€‚</p>
<p>ç°åœ¨ï¼Œä¸ºäº†æœ€åç»“æŸæœ¬èŠ‚ï¼Œåœ¨lib.rsæ—è¾¹åˆ›å»ºä¸€ä¸ªæ–°çš„entrypoint.rsæ–‡ä»¶ï¼Œå¹¶å°†lib.rsçš„ä»£ç ç§»åˆ°é‚£é‡Œã€‚æœ€åï¼Œåœ¨lib.rså†…æ³¨å†Œentrypointæ¨¡å—ã€‚ä½ å¿…é¡»å¯¹æˆ‘ä»¬åˆ›å»ºçš„æ‰€æœ‰æ–‡ä»¶éƒ½è¿™æ ·åšã€‚</p>
<p>theory recap ğŸ“š<br>
each program is processed by its BPF Loader and has an entrypoint whose structure depends on which BPF Loader is used
accounts are used to store state
accounts are owned by programs
only the account owner may debit an account and adjust its data
all accounts to be written to or read must be passed into the entrypoint</p>
<h2 id=alices-transaction>Aliceâ€™s transaction<a hidden class=anchor aria-hidden=true href=#alices-transaction>#</a></h2>
<h3 id=instruction>instruction<a hidden class=anchor aria-hidden=true href=#instruction>#</a></h3>
<p>å‰ä¸€æ®µä¸­æˆ‘ä»¬åˆ›å»ºäº†<code>entrypoint.rs</code>,æè¿°äº†ç¨‹åºçš„å…¥å£,ç°åœ¨æˆ‘ä»¬åˆ›å»º<code>instruction.rs</code>,æ¥ä¸ºç¨‹åºå®ç°API.
ä¸ºäº†é¦–å…ˆæœ‰ä¸ªæ€»ä½“å°è±¡,æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹solana çš„programç»“æ„:</p>
<pre tabindex=0><code>.
â”œâ”€ src
â”‚  â”œâ”€ lib.rs -&gt; registering modules
â”‚  â”œâ”€ entrypoint.rs -&gt; entrypoint to the program
â”‚  â”œâ”€ instruction.rs -&gt; program API, (de)serializing instruction data
â”‚  â”œâ”€ processor.rs -&gt; program logic
â”‚  â”œâ”€ state.rs -&gt; program objects, (de)serializing state
â”‚  â”œâ”€ error.rs -&gt; program specific errors
â”œâ”€ .gitignore
â”œâ”€ Cargo.lock
â”œâ”€ Cargo.toml
â”œâ”€ Xargo.toml
</code></pre><p>æè¿°æµç¨‹çš„è¯æ˜¯è¿™æ ·çš„:</p>
<ol>
<li>ç”¨æˆ·è°ƒç”¨entrypoint</li>
<li>entrypointè½¬å‘å‚æ•°åˆ°processor</li>
<li>processor è¦æ±‚ instructionè§£ç entrypointä¼ å…¥çš„instruction_data</li>
<li>ä½¿ç”¨è¢«è§£ç çš„æ•°æ®,processorä¼šå†³å®šç”¨ä»€ä¹ˆå‡½æ•°å¤„ç†è¯·æ±‚</li>
<li>processorå¯ä»¥ä½¿ç”¨state.rså°†çŠ¶æ€ç¼–ç åˆ°å·²ä¼ å…¥entrypointçš„è´¦æˆ·ä¸­ï¼Œæˆ–å¯¹è´¦æˆ·çš„çŠ¶æ€è¿›è¡Œè§£ç ã€‚</li>
</ol>
<p>æ ¸å¿ƒæ˜¯:</p>
<blockquote>
<p>instruction.rs defines the &ldquo;API&rdquo; of a program</p>
</blockquote>
<p>å›åˆ°escrow</p>
<p>Aliceå’ŒBobçš„ä¸»è´¦æˆ·éƒ½æ˜¯<code>system_program</code>çš„è´¦æˆ·,è€Œä»–ä»¬æƒ³äº¤æ˜“çš„token,ç”±<code>token program</code>åˆ›å»º.ä»–ä»¬è¦æŒæœ‰token,å°±éœ€è¦æ‹¥æœ‰ç”±<code>token program</code>åˆ›å»ºçš„è´¦æˆ·. Aliceå’ŒBobéƒ½éœ€è¦æŒæœ‰å¯¹æ–¹è¦äº¤æ˜“çš„tokençš„ç‰¹åˆ«è´¦æˆ·æ‰èƒ½å®Œæˆäº¤æ˜“,æ‰€ä»¥åœ¨Aliceå’ŒBobçš„äº¤æ˜“å¯¹ä¸­,æˆ‘ä»¬è‡³å°‘è¦æœ‰4ä¸ªè´¦æˆ·.</p>
<p><img loading=lazy src=../../static/image/df070a8.png alt=escrow3>
</p>
<h3 id=token-ownership--transfer-ownership>token ownership && transfer ownership<a hidden class=anchor aria-hidden=true href=#token-ownership--transfer-ownership>#</a></h3>
<p>å¦‚æœä¸ºäº†æ‰§è¡Œäº¤æ˜“,Aliceå’ŒBobéƒ½æŒæœ‰ä¸åŒçš„tokenè´¦æˆ·,è®°ä½ä¸åŒçš„tokenå¯†é’¥å»æ‰§è¡Œäº¤æ˜“,æœªå…å¤ªè¿‡ç¹ç.solanaçš„ä»£å¸ç¨‹åºè§„é¿äº†è¿™ç§æ–¹å¼: token(ä»£å¸)è´¦æˆ·çš„æ‰€æœ‰è€…åªèƒ½æ˜¯programæœ¬èº«,è€Œtokenæœ¬èº«çš„æ‰€æœ‰è€…,è¯¸å¦‚aliceè¿˜æœ‰Bobç­‰ç”¨æˆ·,åˆ™æ˜¯programåœ¨ç”¨æˆ·ç©ºé—´å£°æ˜çš„æ•°æ®,æ•°æ®è¢«ç¼–ç åœ¨ä»£å¸è´¦æˆ·ä¸­,æ­¤å¤–è¿˜æœ‰<a href=https://github.com/solana-labs/solana-program-library/blob/80e29ef6b9a081d457849a2ca42db50d7da0e37e/token/program/src/state.rs#L86>å…¶ä»–å±æ€§</a>,å¦‚è´¦æˆ·æŒæœ‰çš„ä»£å¸ä½™é¢. æ‰€æœ‰,åç»­ä¼šå°†tokençš„æ‰€æœ‰è€…è¢«ç§°ä¸º<code>authority</code>,è€Œsolanaå†…éƒ¨çš„tokenæ‰€æœ‰è€…è¢«ç§°ä¸º<code>owner</code>.è¿™å…¶å®æ­ç¤ºäº†solanaçš„tokenæ‰€æœ‰æƒæœºåˆ¶:</p>
<blockquote>
<p>All internal Solana internal account information are saved into fields on the account (opens new window)but never into the data field which is solely meant for user space information
æ‰€æœ‰Solanaå†…éƒ¨è´¦æˆ·çš„ä¿¡æ¯éƒ½è¢«ä¿å­˜åœ¨è´¦æˆ·çš„å­—æ®µä¸­ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰ï¼Œä½†ç»ä¸ä¼šä¿å­˜åœ¨æ•°æ®å­—æ®µä¸­ï¼Œå› ä¸ºæ•°æ®å­—æ®µåªç”¨äºç”¨æˆ·ç©ºé—´ä¿¡æ¯</p>
</blockquote>
<p><img loading=lazy src=../../static/image/account.7425ef71.png alt="solana account">
ä¸‹å›¾ç®€å•çš„æè¿°äº† â€œç”¨æˆ·ç©ºé—´â€ ä¸­tokençš„æ‰€æœ‰æƒ.
<img loading=lazy src=../../static/image/escrow_token_accounts_1.ae89bb8d.png alt=escrow_token_accounts_1>
Aliceä¸ºäº†ä½¿ç”¨ä¸€éƒ¨åˆ†tokenä¸Bobè¿›è¡Œäº¤æ˜“,å¥¹åˆ›å»ºäº†ä¸€ä¸ªå…³äºX tokençš„ä¸´æ—¶è´¦æˆ·,å¹¶å‘å…¶è½¬ç§»äº¤æ˜“é‡çš„token,éšåå¥¹è°ƒç”¨token programä¸­çš„å‡½æ•°,å°†è¿™ä¸ªä¸´æ—¶çš„æ‰€æœ‰æƒè½¬ç§»åˆ°äº†æ‰˜ç®¡ç¨‹åºä¸­.è€Œè¿™ä¸ªæ‰˜ç®¡ç¨‹åº,å°±æ˜¯åé¢è¦æ¶‰åŠåˆ°çš„åˆçº¦ä¸ºå…¶ç”Ÿæˆçš„PDA.
<img loading=lazy src=../../static/image/escrow_token_accounts_2.9291f5c8.png alt=escrow_token_accounts_2>
</p>
<h3 id=ç»§ç»­å›åˆ°-instruction>ç»§ç»­å›åˆ° Instruction<a hidden class=anchor aria-hidden=true href=#ç»§ç»­å›åˆ°-instruction>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rs data-lang=rs><span style=color:#75715e>// inside instruction.rs
</span><span style=color:#75715e></span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>EscrowInstruction</span> {

    <span style=color:#e6db74>/// Starts the trade by creating and populating an escrow account and transferring ownership of the given temp token account to the PDA
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>///
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>///
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>/// Accounts expected:
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>///
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>/// 0. `[signer]` The account of the person initializing the escrow
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>/// 1. `[writable]` Temporary token account that should be created prior to this instruction and owned by the initializer
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>/// 2. `[]` The initializer&#39;s token account for the token they will receive should the trade go through
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>/// 3. `[writable]` The escrow account, it will hold all necessary info about the trade.
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>/// 4. `[]` The rent sysvar
</span><span style=color:#e6db74></span>    <span style=color:#e6db74>/// 5. `[]` The token program
</span><span style=color:#e6db74></span>    InitEscrow {
        <span style=color:#e6db74>/// The amount party A expects to receive of token Y
</span><span style=color:#e6db74></span>        amount: <span style=color:#66d9ef>u64</span>
    }
}
</code></pre></div><p>å›åˆ°instruction,æˆ‘ä»¬å…ˆæ·»åŠ ç¬¬ä¸€ä¸ªæŒ‡ä»¤.é€šè¿‡è¿™ä¸ªæŒ‡ä»¤,Aliceå¯ä»¥åˆå§‹åŒ–å¥¹æƒ³æ‰§è¡Œçš„äº¤æ˜“.</p>
<p>æ³¨æ„,<code>///</code>è¿™ç§æ³¨é‡Šä¸ä¼šå½±å“åˆ°ä»£ç . <code>writable</code>æ ‡å¿—æ„å‘³ç€,è°ƒç”¨ä¼šå°è¯•å†™è´¦æˆ·,å¦‚æœå¤±è´¥äº†é‚£ä¹ˆäº¤æ˜“ä¼šå¤±è´¥.</p>
<p>è®¾: Aliceå‘èµ·äº¤æ˜“å­˜å…¥token Xå¹¶è®¾ç½®éœ€è¦çš„token Yæ•°é‡, ç¨åBobä¼šæ‹¿token Yå»æ‰§è¡Œäº¤æ˜“
é‚£ä¹ˆ, Aliceé¦–å…ˆè°ƒç”¨ InitEscrow,è¿™æ¡æŒ‡ä»¤æœŸå¾…çš„Accountså°±å¦‚ä¸‹æ‰€ç¤º:
0. <code>[signer]</code> è¢«ç”¨æ¥äº¤æ˜“æŒæœ‰tokenæ‰€æœ‰æƒçš„ä¸´æ—¶è´¦æˆ·,å…¶éœ€è¦Aliceçš„ç­¾å,æ‰€ä»¥è¿™æ˜¯Aliceçš„åœ°å€,å£°æ˜äº†ç­¾åäººæ˜¯è°</p>
<ol>
<li>éœ€è¦è¢«å†™å…¥çš„ temp token X account</li>
<li>aliceâ€˜s token Y account</li>
<li>ä¸€ä¸ªå¯å†™çš„escrow account</li>
<li>rent sysvar ç§Ÿé‡‘è´¦æˆ·å˜é‡</li>
<li>token program</li>
</ol>
<p>éšåæˆ‘ä»¬å®ç°instructionå¯¹instruction_dataçš„è§£ç æ“ä½œ:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rs data-lang=rs><span style=color:#75715e>// inside instruction.rs
</span><span style=color:#75715e></span><span style=color:#66d9ef>use</span> std::convert::TryInto;
<span style=color:#66d9ef>use</span> solana_program::program_error::ProgramError;

<span style=color:#66d9ef>use</span> <span style=color:#66d9ef>crate</span>::error::EscrowError::InvalidInstruction;

 <span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>EscrowInstruction</span> {
    InitEscrow {
        <span style=color:#e6db74>/// The amount party A expects to receive of token Y
</span><span style=color:#e6db74></span>        amount: <span style=color:#66d9ef>u64</span>
    }
}

<span style=color:#66d9ef>impl</span> EscrowInstruction {
    <span style=color:#e6db74>/// Unpacks a byte buffer into a [EscrowInstruction](enum.EscrowInstruction.html).
</span><span style=color:#e6db74></span>    <span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>unpack</span>(input: <span style=color:#66d9ef>&amp;</span>[<span style=color:#66d9ef>u8</span>]) -&gt; Result<span style=color:#f92672>&lt;</span>Self, ProgramError<span style=color:#f92672>&gt;</span> {
        <span style=color:#66d9ef>let</span> (tag, rest) <span style=color:#f92672>=</span> input.split_first().ok_or(InvalidInstruction)<span style=color:#f92672>?</span>;

        Ok(<span style=color:#66d9ef>match</span> tag {
            <span style=color:#ae81ff>0</span> <span style=color:#f92672>=&gt;</span> Self::InitEscrow {
                amount: <span style=color:#a6e22e>Self</span>::unpack_amount(rest)<span style=color:#f92672>?</span>,
            },
            _ <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>return</span> Err(InvalidInstruction.into()),
        })
    }

    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>unpack_amount</span>(input: <span style=color:#66d9ef>&amp;</span>[<span style=color:#66d9ef>u8</span>]) -&gt; Result<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>u64</span>, ProgramError<span style=color:#f92672>&gt;</span> {
        <span style=color:#66d9ef>let</span> amount <span style=color:#f92672>=</span> input
            .get(<span style=color:#f92672>..</span><span style=color:#ae81ff>8</span>)
            .and_then(<span style=color:#f92672>|</span>slice<span style=color:#f92672>|</span> slice.try_into().ok())
            .map(<span style=color:#66d9ef>u64</span>::from_le_bytes)
            .ok_or(InvalidInstruction)<span style=color:#f92672>?</span>;
        Ok(amount)
    }
}
</code></pre></div><p><code>unpack</code><a href=https://doc.rust-lang.org/stable/book/ch04-02-references-and-borrowing.html>å®ç°</a>äº†è§£æ&[u8] (ä¸€ä¸ªè¢«å¼•ç”¨çš„u8æ•°ç»„).è¿™é‡Œ,u8æ•°ç»„çš„ç¬¬ä¸€ä¸ªbyteè¢«ç”¨æ¥ä½œä¸ºtagå»è¯†åˆ«ç±»å‹. <code>unpack_amount</code>è¿™é‡Œç”¨æ¥è·å¾—ç»“æ„ä½“ä¸­çš„amountå…·ä½“é‡‘é¢,å…¶ä»£è¡¨äº†Aliceæƒ³è¦è·å¾—çš„token Yæ•°é‡.</p>
<h3 id=processrs>process.rs<a hidden class=anchor aria-hidden=true href=#processrs>#</a></h3>
<p>èƒ½è§£æç”¨æˆ·è°ƒç”¨æ•°æ®å,æˆ‘ä»¬å¼€å§‹ç¼–å†™processor,æ¥å®ç°åˆçº¦æ“ä½œ.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rs data-lang=rs><span style=color:#66d9ef>use</span> solana_program::{
    account_info::AccountInfo,
    entrypoint::ProgramResult,
    msg,
    pubkey::Pubkey,
};

<span style=color:#66d9ef>use</span> <span style=color:#66d9ef>crate</span>::instruction::EscrowInstruction;

<span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Processor</span>;
<span style=color:#66d9ef>impl</span> Processor {
    <span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>process</span>(program_id: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>Pubkey</span>, accounts: <span style=color:#66d9ef>&amp;</span>[AccountInfo], instruction_data: <span style=color:#66d9ef>&amp;</span>[<span style=color:#66d9ef>u8</span>]) -&gt; <span style=color:#a6e22e>ProgramResult</span> {
        <span style=color:#66d9ef>let</span> instruction <span style=color:#f92672>=</span> EscrowInstruction::unpack(instruction_data)<span style=color:#f92672>?</span>;

        <span style=color:#66d9ef>match</span> instruction {
            EscrowInstruction::InitEscrow { amount } <span style=color:#f92672>=&gt;</span> {
                msg<span style=color:#f92672>!</span>(<span style=color:#e6db74>&#34;Instruction: InitEscrow&#34;</span>); <span style=color:#75715e>//æ—¥å¿—ä¿¡æ¯
</span><span style=color:#75715e></span>                Self::process_init_escrow(accounts, amount, program_id)
            }
        }
    }
}
</code></pre></div><p>è¿™æ®µä»£ç é€»è¾‘æ¯”è¾ƒç®€å•,åœ¨æ¥å—åˆ°æŒ‡ä»¤å,è§£ææˆæ•°æ®,æ‰§è¡Œå¯¹åº”çš„processer.</p>
<h3 id=fn-process_init_escrow>fn process_init_escrow<a hidden class=anchor aria-hidden=true href=#fn-process_init_escrow>#</a></h3>
<p>âš ï¸å‰æ–¹å¤§é‡ä»£ç è­¦å‘Šâš ï¸<br>
Don&rsquo;t Panic, æˆ‘ä¼šåœ¨æ³¨é‡Šé‡Œé¢è®²æ¸…æ¥š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rs data-lang=rs><span style=color:#66d9ef>use</span> solana_program::{
    account_info::{next_account_info, AccountInfo},
    entrypoint::ProgramResult,
    program_error::ProgramError,
    msg,
    pubkey::Pubkey,
};
<span style=color:#f92672>..</span>.
 <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>process_init_escrow</span>(
        accounts: <span style=color:#66d9ef>&amp;</span>[AccountInfo],
        amount: <span style=color:#66d9ef>u64</span>,
        program_id: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>Pubkey</span>,
    ) -&gt; <span style=color:#a6e22e>ProgramResult</span> {
        <span style=color:#66d9ef>let</span> account_info_iter <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> accounts.iter(); <span style=color:#e6db74>///å¼€å¯è´¦æˆ·è¿­ä»£å™¨! è®¾ç½®ä¸ºmutableæ˜¯ä¸ºäº†å¯ä»¥ç§»åŠ¨è´¦æˆ·çš„æ‰€æœ‰æƒ
</span><span style=color:#e6db74></span>        <span style=color:#66d9ef>let</span> initializer <span style=color:#f92672>=</span> next_account_info(account_info_iter)<span style=color:#f92672>?</span>; 

        <span style=color:#75715e>//Alice main account,åœ¨è¿™ç¬”äº¤æ˜“ä¸­,å¥¹éœ€è¦æ˜¯ä¸€ä¸ªsigner
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span>initializer.is_signer {
            <span style=color:#66d9ef>return</span> Err(ProgramError::MissingRequiredSignature);
        }

        <span style=color:#66d9ef>let</span> temp_token_account <span style=color:#f92672>=</span> next_account_info(account_info_iter)<span style=color:#f92672>?</span>;
        <span style=color:#66d9ef>let</span> token_to_receive_account <span style=color:#f92672>=</span> next_account_info(account_info_iter)<span style=color:#f92672>?</span>;
        <span style=color:#75715e>// Q: &#34;why do we check that the token_to_receive_account is actually owned by the token program but don&#39;t do the same for the temp_token_account?&#34;.
</span><span style=color:#75715e></span>        <span style=color:#75715e>// Q: ä¸ºä»€ä¹ˆè¦æ£€æŸ¥token_to_receive_accountæ˜¯å¦çœŸçš„ä¸ºtokenç¨‹åºæ‰€æœ‰?è€Œä¸æ˜¯å¯¹temp_token_accountåšåŒæ ·çš„æ£€æŸ¥?
</span><span style=color:#75715e></span>        <span style=color:#75715e>// A: åœ¨å‡½æ•°çš„åé¢ï¼Œæˆ‘ä»¬å°†è¦æ±‚ä»¤ç‰Œç¨‹åºå°†temp_token_accountçš„æ‰€æœ‰æƒè½¬ç§»ç»™PDAã€‚å¦‚æœtemp_token_accountä¸å±äºtokenç¨‹åºï¼Œé‚£ä¹ˆè¿™ä¸ªè½¬ç§»å°±ä¼šå¤±è´¥ï¼Œ
</span><span style=color:#75715e></span>        <span style=color:#75715e>// åªæœ‰è´¦æˆ·çš„æ‹¥æœ‰è€…å¯ä»¥ä¿®æ”¹è´¦æˆ·
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>*</span>token_to_receive_account.owner <span style=color:#f92672>!=</span> spl_token::id() {
            <span style=color:#66d9ef>return</span> Err(ProgramError::IncorrectProgramId);
        }

        <span style=color:#75715e>// 
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> escrow_account <span style=color:#f92672>=</span> next_account_info(account_info_iter)<span style=color:#f92672>?</span>;
        <span style=color:#66d9ef>let</span> rent <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>Rent::from_account_info(next_account_info(account_info_iter)<span style=color:#f92672>?</span>)<span style=color:#f92672>?</span>;

        <span style=color:#75715e>// å…ç§Ÿç§Ÿé‡‘
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span>rent.is_exempt(escrow_account.lamports(), escrow_account.data_len()) {
            <span style=color:#66d9ef>return</span> Err(EscrowError::NotRentExempt.into());
        }

        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> escrow_info <span style=color:#f92672>=</span> Escrow::unpack_unchecked(<span style=color:#f92672>&amp;</span>escrow_account.try_borrow_data()<span style=color:#f92672>?</span>)<span style=color:#f92672>?</span>;
        <span style=color:#66d9ef>if</span> escrow_info.is_initialized() {
            <span style=color:#66d9ef>return</span> Err(ProgramError::AccountAlreadyInitialized);
        }

        escrow_info.expected_amount <span style=color:#f92672>=</span> amount;
        Escrow::pack(escrow_info, <span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> escrow_account.try_borrow_mut_data()<span style=color:#f92672>?</span>)<span style=color:#f92672>?</span>;
        <span style=color:#66d9ef>let</span> (pda, _bump_seed) <span style=color:#f92672>=</span> Pubkey::find_program_address(<span style=color:#f92672>&amp;</span>[<span style=color:#e6db74>b&#34;escrow&#34;</span>], program_id);

        <span style=color:#66d9ef>let</span> token_program <span style=color:#f92672>=</span> next_account_info(account_info_iter)<span style=color:#f92672>?</span>;
        <span style=color:#66d9ef>let</span> owner_change_ix <span style=color:#f92672>=</span> spl_token::instruction::set_authority(
            token_program.key,
            temp_token_account.key,
            Some(<span style=color:#f92672>&amp;</span>pda),
            AuthorityType::AccountOwner,
            initializer.key,
            <span style=color:#f92672>&amp;</span>[<span style=color:#f92672>&amp;</span>initializer.key],
        )<span style=color:#f92672>?</span>;

        invoke(
            <span style=color:#f92672>&amp;</span>owner_change_ix,
            <span style=color:#f92672>&amp;</span>[
                temp_token_account.clone(),
                initializer.clone(),
                token_program.clone(),
            ],
        )<span style=color:#f92672>?</span>;

        Ok(())
    }
</code></pre></div><p><code>rent</code>sysvarå‡ºç°åœ¨äº†processçš„è¿‡ç¨‹ä¸­.</p>
<blockquote>
<p>Rent is deducted from an account&rsquo;s balance according to their space requirements (i.e. the space an account and its fields take up in memory) regularly. An account can, however, be made rent-exempt if its balance is higher than some threshold that depends on the space it&rsquo;s consuming</p>
</blockquote>
<p>Aliceè½¬è´¦è¿‡ç¨‹ä¸­å¼€äº†ä¸ªè´¦æˆ·,åœ¨ç§Ÿé‡‘ä¸Šä¸æ˜¯å…ç§Ÿçš„,å¥¹ä»¥æ­¤å‘Bobå‘èµ·äº†äº¤æ˜“. Bobå½“æ—¶æ²¡æœ‰æ”¶å–,åå¹´å,Aliceå‘Bobå‘é€çš„1000ä¸ªX tokenç°åœ¨èƒ½æ¢åä¸ªäº¿äº†,Bobæƒ³èµ·æ¥è‡ªå·±æœ‰ä¸ªæš´å¯Œçš„æœºä¼šå†³å®šå»æ”¶å–,ä½†æ˜¯è´¦æˆ·å› ä¸ºç§Ÿé‡‘ä¸æ˜¯å…ç§Ÿçš„,è¢«solanaç³»ç»Ÿå¹²æ‰äº†.<br>
è¿™åˆç†å—?è¿™ä¸åˆç†.<br>
æ›´ä½•å†µ,ç°åœ¨ç§Ÿé‡‘å‡ ä¹æ˜¯ä¸¤åˆ°ä¸‰å¤©ä¸€æ”¶(epoch),å¦‚æœä¸æ˜¯å…ç§Ÿçš„,å¾ˆå¿«å°±ä¼šè¿™æ ·æ„å¤–çš„burnæ‰äº†token,è¿™æ˜¯ä¸å¯é¢„æœŸçš„é”™è¯¯è¡Œä¸º. æ‰€ä»¥ä¸ºäº†äº¤æ˜“çš„å®‰å…¨,aliceå¿…é¡»å‘è¿™ä¸ªè´¦æˆ·å­˜å¤Ÿèƒ½è®©å…¶å…ç§Ÿçš„sol/lamports.</p>
<p>æœ€åè®°å¾—</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[<span style=color:#a6e22e>dependencies</span>]
<span style=color:#a6e22e>solana-program</span> = <span style=color:#e6db74>&#34;1.9.4&#34;</span>
<span style=color:#a6e22e>spl-token</span> = {<span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;3.2.0&#34;</span>, <span style=color:#a6e22e>features</span> = [<span style=color:#e6db74>&#34;no-entrypoint&#34;</span>]}
</code></pre></div><h3 id=errorrs>error.rs<a hidden class=anchor aria-hidden=true href=#errorrs>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>...
[<span style=color:#a6e22e>dependencies</span>]
<span style=color:#a6e22e>solana-program</span> = <span style=color:#e6db74>&#34;1.9.4&#34;</span>
<span style=color:#a6e22e>spl-token</span> = {<span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;3.2.0&#34;</span>, <span style=color:#a6e22e>features</span> = [<span style=color:#e6db74>&#34;no-entrypoint&#34;</span>]}
<span style=color:#a6e22e>thiserror</span> = <span style=color:#e6db74>&#34;1.0.24&#34;</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rs data-lang=rs><span style=color:#75715e>// inside error.rs
</span><span style=color:#75715e></span><span style=color:#66d9ef>use</span> thiserror::Error;

<span style=color:#66d9ef>use</span> solana_program::program_error::ProgramError;

<span style=color:#75715e>#[derive(Error, Debug, Copy, Clone)]</span>
<span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>EscrowError</span> {
    <span style=color:#e6db74>/// Invalid instruction
</span><span style=color:#e6db74></span>    <span style=color:#75715e>#[error(</span><span style=color:#e6db74>&#34;Invalid Instruction&#34;</span><span style=color:#75715e>)]</span>
    InvalidInstruction,
}

<span style=color:#66d9ef>impl</span> From<span style=color:#f92672>&lt;</span>EscrowError<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> ProgramError {
    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>from</span>(e: <span style=color:#a6e22e>EscrowError</span>) -&gt; <span style=color:#a6e22e>Self</span> {
        ProgramError::Custom(e <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>u32</span>)
    }
}
</code></pre></div><h3 id=staters>state.rs<a hidden class=anchor aria-hidden=true href=#staters>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rs data-lang=rs><span style=color:#66d9ef>use</span> solana_program::pubkey::Pubkey;

<span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Escrow</span> {
    <span style=color:#66d9ef>pub</span> is_initialized: <span style=color:#66d9ef>bool</span>,
    <span style=color:#66d9ef>pub</span> initializer_pubkey: <span style=color:#a6e22e>Pubkey</span>,
    <span style=color:#66d9ef>pub</span> temp_token_account_pubkey: <span style=color:#a6e22e>Pubkey</span>,
    <span style=color:#66d9ef>pub</span> initializer_token_to_receive_account_pubkey: <span style=color:#a6e22e>Pubkey</span>,
    <span style=color:#66d9ef>pub</span> expected_amount: <span style=color:#66d9ef>u64</span>,
}
</code></pre></div><h3 id=cpis>CPIs<a hidden class=anchor aria-hidden=true href=#cpis>#</a></h3>
<h3 id=program-derived-address-pdas>Program Derived Address PDAs<a hidden class=anchor aria-hidden=true href=#program-derived-address-pdas>#</a></h3>
<h2 id=bobs-transaction>Bobâ€˜s Transaction<a hidden class=anchor aria-hidden=true href=#bobs-transaction>#</a></h2>
<h2 id=anchor>Anchor<a hidden class=anchor aria-hidden=true href=#anchor>#</a></h2>
<p>èµ°å®Œä¸Šé¢çš„æµç¨‹,æ˜¯ä¸æ˜¯æ„Ÿå—åˆ°äº†ç²—é™‹å’Œç¹ç?<br>
ä¼ è¾“æ•°æ®ç”¨çš„æ˜¯æœ€åŸºæœ¬çš„Accountsæ•°ç»„/u8æ•°ç»„,ä¸ºäº†æ‹¿åˆ°æ•°æ®,æˆ‘ä»¬è¦é€šè¿‡è®¡ç®—æ•°æ®çš„é•¿åº¦,ä¸€ä¸ªä¸ªå–å‡ºæ¥å¹¶å¼ºå£®,è¿™çœ‹èµ·æ¥å¹¶ä¸åƒæ˜¯ç°ä»£äººä¼šå¹²çš„äº‹æƒ….<br>
æ‰€ä»¥è¿™é‡Œä»‹ç»ä¸€ä¸‹Anchor,å…¶å°†ä¹‹å‰ç¹çæ­¥éª¤ä¸­ä¸æ–­é‡å¤çš„ç»å¤§å¤šæ•°éƒ½ç”¨å®åšäº†åŒ–ç®€,æ¥é™ä½æˆ‘ä»¬å¯æ€œçš„1500mlå·¦å³çš„çš„è„‘æµ†ä¸Šçš„å¿ƒæ™ºè´Ÿæ‹….</p>
<h3 id=anchor-install>Anchor install<a hidden class=anchor aria-hidden=true href=#anchor-install>#</a></h3>
<h3 id=heading><a hidden class=anchor aria-hidden=true href=#heading>#</a></h3>
<h2 id=å‚è€ƒ>å‚è€ƒ<a hidden class=anchor aria-hidden=true href=#å‚è€ƒ>#</a></h2>
<ol>
<li><a href=https://paulx.dev/blog/2021/01/14/programming-on-solana-an-introduction/#processor-part-2-pdas-part-2-cpis-part-1>Programming on Solana - An Introduction</a></li>
</ol>
</div>
<footer class=post-footer>
<ul class=post-tags>
</ul>
<nav class=paginav>
<a class=prev href=https://blog.explosion.zip/posts/telepresence%E8%B8%A9%E5%9D%91/>
<span class=title>Â« Prev</span>
<br>
<span>Telepresenceè¸©å‘</span>
</a>
<a class=next href=https://blog.explosion.zip/posts/rust-pin-unpin/>
<span class=title>Next Â»</span>
<br>
<span>Rust Pin Unpin</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Solanaåˆçº¦å¼€å‘æŒ‡åŒ— on twitter" href="https://twitter.com/intent/tweet/?text=Solana%e5%90%88%e7%ba%a6%e5%bc%80%e5%8f%91%e6%8c%87%e5%8c%97&url=https%3a%2f%2fblog.explosion.zip%2fposts%2fsolana%25E5%2590%2588%25E7%25BA%25A6%25E5%25BC%2580%25E5%258F%2591%25E6%258C%2587%25E5%258C%2597%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Solanaåˆçº¦å¼€å‘æŒ‡åŒ— on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.explosion.zip%2fposts%2fsolana%25E5%2590%2588%25E7%25BA%25A6%25E5%25BC%2580%25E5%258F%2591%25E6%258C%2587%25E5%258C%2597%2f&title=Solana%e5%90%88%e7%ba%a6%e5%bc%80%e5%8f%91%e6%8c%87%e5%8c%97&summary=Solana%e5%90%88%e7%ba%a6%e5%bc%80%e5%8f%91%e6%8c%87%e5%8c%97&source=https%3a%2f%2fblog.explosion.zip%2fposts%2fsolana%25E5%2590%2588%25E7%25BA%25A6%25E5%25BC%2580%25E5%258F%2591%25E6%258C%2587%25E5%258C%2597%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Solanaåˆçº¦å¼€å‘æŒ‡åŒ— on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.explosion.zip%2fposts%2fsolana%25E5%2590%2588%25E7%25BA%25A6%25E5%25BC%2580%25E5%258F%2591%25E6%258C%2587%25E5%258C%2597%2f&title=Solana%e5%90%88%e7%ba%a6%e5%bc%80%e5%8f%91%e6%8c%87%e5%8c%97"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Solanaåˆçº¦å¼€å‘æŒ‡åŒ— on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.explosion.zip%2fposts%2fsolana%25E5%2590%2588%25E7%25BA%25A6%25E5%25BC%2580%25E5%258F%2591%25E6%258C%2587%25E5%258C%2597%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Solanaåˆçº¦å¼€å‘æŒ‡åŒ— on whatsapp" href="https://api.whatsapp.com/send?text=Solana%e5%90%88%e7%ba%a6%e5%bc%80%e5%8f%91%e6%8c%87%e5%8c%97%20-%20https%3a%2f%2fblog.explosion.zip%2fposts%2fsolana%25E5%2590%2588%25E7%25BA%25A6%25E5%25BC%2580%25E5%258F%2591%25E6%258C%2587%25E5%258C%2597%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Solanaåˆçº¦å¼€å‘æŒ‡åŒ— on telegram" href="https://telegram.me/share/url?text=Solana%e5%90%88%e7%ba%a6%e5%bc%80%e5%8f%91%e6%8c%87%e5%8c%97&url=https%3a%2f%2fblog.explosion.zip%2fposts%2fsolana%25E5%2590%2588%25E7%25BA%25A6%25E5%25BC%2580%25E5%258F%2591%25E6%258C%2587%25E5%258C%2597%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2024 <a href=https://blog.explosion.zip/>ç¬”è®°</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>